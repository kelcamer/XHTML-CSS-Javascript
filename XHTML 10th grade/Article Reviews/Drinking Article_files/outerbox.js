var TRCRBox=function(a,b,c,d){this.domain="trc.taboolasyndication.com";this.syndicationDomain="sponsored.taboolasyndication.com";this.origin=a;this.header=false;this.item_id_array=[];this.reqParams=d;this.reqParams.req=null;this.id="trc_"+Math.floor(Math.random()*100000);this.response=this.request=null;__trcCopyProps(b,this);this.loaded=false;this.element=null;this.listContainer=null;this.loaderAnim=null;this.retryCount=0;this.drawList=false;this.trc=c;this.timeoutId=null;this.errorHandler="";this.boxes=[];this.visible_boxes=[];this.recommendationList=null;this.autoPlayer=null;this.use_cdn=(this.trc.getProperty(this.mode_name,"use-cdn-recommendations")!==false);this.postRenderQueue=new window.TRC.PostRenderQueue();this.pager=null;this.src=null;this.publisher=window.trc_publisher_id;if(this.syndicator){this.publisher=this.syndicator}this.auto_scroll_interval=null;this.auto_scroll=null;if(this.syndicator&&typeof this.trc.global!="undefined"){this.link_target=this.trc.global[this.syndicator+"-syndication-product"]}return this};TRCRBox.prototype.genRBoxURL=function(){if(window.trc_testmode){return this.getRetryUrl("static-preview")}var d=this.trc.getProperty(this.mode_name,"required-attributes");var c={publisher:window.trc_publisher_id,pv:"2","list-size":(this.visible?this.trc.getProperty(this.mode_name,"list-size"):0),"list-id":this.getListId(),id:parseInt(Math.random()*1000),uim:this.mode_name,syndicator:this.syndicator?this.syndicator:undefined,testmode:this.testmode?"true":undefined,label:!!window.trc_label?window.trc_label:undefined,intent:typeof this.trc.get_intent=="function"?this.trc.get_intent(this):undefined,ac:this.category?this.category:undefined,uip:this.placement?this.placement:undefined,external:this.reqParams.external?this.reqParams.external:undefined,ra:(typeof d!="undefined"&&d!="none")?d:undefined};if(this.article){c.sii=this.article;c.sit="text"}else{if(this.video){c.sii=this.video;c.sit="video"}}if(window.trc_debug_level){c.llvl=window.trc_debug_level}for(var a in this.reqParams){switch(a){case"external":case"pv":case"req":continue}if(this.reqParams[a]==null||typeof this.reqParams[a]=="undefined"){continue}if(a=="item-url"){if(this.reqParams[a].search("taboolasyndication.com")>0||this.reqParams[a].search("taboola.com")>0){continue}if(PageManager&&PageManager.isEmbeddedView()){c.embed=this.reqParams[a];continue}}if(a=="item-id"&&this.getListId()=="rbox-h2v"){this.reqParams[a]="_homepage_"}c[a]=this.reqParams[a]}this.item_id_array.push(this.reqParams["item-id"]);var f=[];for(var b in c){if(typeof c[b]=="undefined"){continue}c[b]=this.trc["normalize-request-param"](b,c[b],this.mode_name);f.push(encodeURIComponent(b)+"="+encodeURIComponent(c[b]))}return"http://trc.taboolasyndication.com/"+c.publisher+"/trc/"+c.pv+"/json?tim="+encodeURIComponent(__trcClientTimestamp())+"&"+f.join("&")+PageManager.additionalDispatchParams()};TRCRBox.prototype.getListId=function(){var a=this.trc.getProperty(this.mode_name,"component-id");if(a&&a.length>0){return a}return"rbox-"+this.origin};TRCRBox.prototype.generateRDiv=function(){var a=document.createElement("div");a.id=this.getListId();a.className="trc_rbox_div trc_rbox_border_elm";if(this.element.style.display!="none"){a.style.display="none"}a.style.overflowX="hidden";a.style.overflowY="hidden";return a};TRCRBox.prototype.is_box_visible=function(c){if(c.clientHeight<=0){return false}var f=(c.offsetTop<0)?0:c.offsetTop;var d=(c.offsetLeft<0)?0:c.offsetLeft;var b=c.offsetLeft+c.clientWidth*0.5;var a=c.offsetTop+c.clientHeight*0.5;if(((f>=this.listContainer.scrollTop)&&(f<(this.listContainer.scrollTop+this.listContainer.offsetHeight)))&&((a>this.listContainer.scrollTop)&&(a<=(this.listContainer.scrollTop+this.listContainer.offsetHeight)))&&((d>=this.listContainer.scrollLeft)&&(d<(this.listContainer.scrollLeft+this.listContainer.offsetWidth)))&&((b>this.listContainer.scrollLeft)&&(b<=(this.listContainer.scrollLeft+this.listContainer.offsetWidth)))){return true}else{return false}};TRCRBox.prototype.generateHeader=function(){var c=document.createElement("div");c.id=this.id.replace("trc_","trc_header_");c.className="trc_rbox_header trc_rbox_border_elm";var b=document.createElement("span");b.className="trc_rbox_header_span";var a=document.createElement("div");c.appendChild(a);a.className="trc_header_ext";c.ext=a;var d=this.trc.getProperty(this.mode_name,"header");if(this.header_value=="No Header"||d=="No Header"||d==""){b.innerHTML=""}else{b.innerHTML=(this.header_value==false)?d:this.header_value}if(!this.addSyndicatorLink(c,b)){c.appendChild(b)}c.titleBox=b;return c};TRCRBox.prototype.render=function(a){var c=this.trc.getProperty(this.mode_name,"loading-animation-url");var b=this.trc.getProperty(this.mode_name,"auto-scroll");this.element=document.createElement("div");this.element.id=this.id.replace("trc_","trc_wrapper_");this.element.className="trc_rbox "+this.mode_name;this.element.style.overflow="hidden";if(typeof b!="undefined"){if(b!="none"){this.element.onmouseover=function(){if(this.auto_scroll_interval!=null){window.clearInterval(this.auto_scroll_interval)}};this.element.onmouseout=function(){if(typeof this.auto_scroll=="function"){if(this.auto_scroll_interval!=null){window.clearInterval(this.auto_scroll_interval)}this.auto_scroll_interval=window.setInterval(this.auto_scroll,parseInt(b))}}}}a.appendChild(this.element);if(c=="hide"){this.element.style.display="none";return}this.generateVisibleParts()};TRCRBox.prototype.generateVisibleParts=function(){if(this.listContainer!=null){return}this.header=this.generateHeader();if(typeof this.header=="object"){this.element.appendChild(this.header)}var a=document.createElement("div");a.id=this.id.replace("trc_","outer_");a.className="trc_rbox_outer";a.style.overflow="hidden";this.listContainer=this.generateRDiv();a.appendChild(this.listContainer);this.element.appendChild(a);this.element.style.display="block";this.addTaboolaLogo()};TRCRBox.prototype.getRetryUrl=function(b){var c=window.trc_publisher_id;var a=window.trc_base_domain;if(this.syndicator){c=this.syndicator;a="http://cdn.taboolasyndication.com/libtrc/"+c+"/"}if(b=="preview"){return a+"trc-"+b+".js"}return a+"trc-"+this.getListId()+"-"+b+".js"};TRCRBox.prototype.check_preview_size_error=function(c,a){var b=a.trc["video-list"].video;if(!(b instanceof Array)){b=[b]}if(c!=this.getRetryUrl("preview")){if(b.length<10){this.src=this.getRetryUrl("preview");return true}}return false};TRCRBox.prototype.loadScriptCallback=function(d){var a="TRCRBox.loadScriptCallback(retry="+this.retryCount+")";__trcInfo("Enter "+a);this.abortRequest();var c=window.trc_testmode?true:false;if(!d.trc||!d.trc["video-list"]||!d.trc["video-list"].video){__trcError("Exit "+a+": pv2 format error");if(this.use_cdn||c){this.src=this.getRetryUrl(c?"preview":"error");this.getData()}else{this.abortRendering()}return}if(c&&this.check_preview_size_error(this.src,d)){__trcInfo("Exit "+a+": preview with not enough items");this.getData();return}this.reqParams.req=d.trc.req;this.reqParams.sd=d.trc["session-data"];this.reqParams.uid=d.trc["user-id"];if(typeof PageManager=="function"){PageManager.storePublisherValue(window.trc_publisher_id,"session-data",d.trc["session-data"]);PageManager.storeValue("user-id",d.trc["user-id"])}if(d.trc["video-list"].video.length<1){__trcInfo("Exit "+a+": no items in response");this.abortRendering();this.sendEvent("available",{},true);return}if(this.drawList){__trcWarn("Exit "+a+": got another response after already drawing");return}this.response=d;if(c){var b={};__trcCopyProps(d,b,true);PageManager.storePublisherValue(this.publisher,"trc_preview_recommendations",__trcJSONify(b))}this.removeAnimation();__trcInfo("Exit "+a+": success");this.drawList=true;this.generateVisibleParts();this.drawListBody(d.trc)};TRCRBox.prototype.loadFailureHandler=function(){var a="TRCRBox.loadFailureHandler(retry="+this.retryCount+")";__trcInfo("Enter "+a);if(!this.request){__trcInfo("Exit "+a+": request was aborted");return}if(typeof trc_json_response=="object"){__trcWarn("Exit "+a+": old style response");this.loadScriptCallback(trc_json_response);delete trc_json_response;return}this.abortRequest();if(this.response){__trcInfo("Exit "+a+": response already received");return}if(!!window.trc_testmode){this.src=this.getRetryUrl("preview");__trcInfo("Exit "+a+": preview")}else{if(!this.use_cdn){__trcError("Aborting on error due to use-cdn=false");this.abortRendering();return}this.src=this.getRetryUrl("error");__trcWarn("Exit "+a+": retrying with "+this.src.split("/")[2].split(".")[0].toUpperCase())}this.getData()};TRCRBox.prototype.abortRequest=function(){if(this.timeoutId){window.clearTimeout(this.timeoutId);this.timeoutId=null}if(!this.request){return}this.request.parentNode.removeChild(this.request);this.request=null};TRCRBox.prototype.sendRequest=function(){var a="TRCRBox.sendRequest(retry="+this.retryCount+")";__trcInfo("Enter "+a);if(this.response){__trcInfo("Exit "+a+": already have response");this.loadScriptCallback(this.response);return}var d=this.trc.getProperty(this.mode_name,"timeout")||8000;this.timeoutId=window.setTimeout((function(){this.timeoutHappened=this.timeoutHappened+1||1;if(!this.use_cdn){__trcError("Timedout waiting for server but not aborting");return}this.abortRequest();this.src=this.getRetryUrl("timeout");__trcWarn("Called TRCRBox.sendRequest.timeout("+this.timeoutHappened+"): retrying with "+this.src.split("/")[2].split(".")[0].toUpperCase());this.getData()}).trcBind(this),d);var b=this.src;if(this.src.search("http://trc")==0){var c="recommendations_"+this.trc.genCallbackId();TRC.callbacks[c]=this.loadScriptCallback.trcBind(this);b+="&cb=TRC.callbacks."+c}this.response=null;try{this.request=this.trc.loadExternal(b,"js",this.loadFailureHandler.trcBind(this),true)}catch(f){__trcError("Exit "+a+": error in loadExternal",f);return}__trcInfo("Exit "+a+": success")};TRCRBox.prototype.abortRendering=function(){var a="TRCRBox.abortRendering(retry="+this.retryCount+")";__trcInfo("Called "+a);this.removeAnimation();this.drawList=true;switch(typeof this.errorHandler){case"string":if(this.listContainer!=null){this.listContainer.appendChild(document.createTextNode("Error getting recommendations: "+this.errorHandler))}return;case"function":this.errorHandler();return}};TRCRBox.prototype.getData=function(){this.loaded=true;this.retryCount++;var a="TRCRBox.getData(retry="+this.retryCount+")";__trcInfo("Enter "+a);if(!this.cdnEventHandler){this.cdnEventHandler=TRC.listen("staticRecommendationsReceived",(function(b){if(!this.response){this.loadScriptCallback(b.response)}}).trcBind(this))}if(window.trc_testmode){if(this.loadedCachedRecommendations()){__trcInfo("Exit "+a+": cached");return}}if(this.retryCount>this.trc.MAX_RETRY){__trcError("Exit "+a+": max retry - last call was to "+this.src.split("/")[2].split(".")[0].toUpperCase());this.abortRendering();return}__trcRegisterDomReadyHandler(this.sendRequest.trcBind(this),(__trcBrowser.ie)?false:true);__trcInfo("Exit "+a+": success")};TRCRBox.prototype.getContainer=function(){return this.element.parentNode};TRCRBox.prototype.getMainBox=function(){return this.element};TRCRBox.prototype.sendEvent=function(b,d,a,f){var c={ri:this.reqParams.req,sd:this.reqParams.sd,ui:this.reqParams.uid,pi:this.reqParams["item-id"],wi:this.response?this.response.trc["watched-item"]:null,pt:this.reqParams["item-type"],li:this.getListId()};__trcCopyProps(d,c);this.trc[a?"log1":"logTrcEvent"](b,c,f)};TRCRBox.prototype.removeAnimation=function(){if(this.loaderAnim==null){return}this.loaderAnim.parentNode.removeChild(this.loaderAnim);this.loaderAnim=null};TRCRBox.prototype.loadedCachedRecommendations=function(){if(PageManager.getPublisherValue(this.publisher,"trc_preview_recommendations")==null||PageManager.getPublisherValue(this.publisher,"trc_preview_recommendations").search("trc")<0){return false}var a=__trcUnJSONify(PageManager.getPublisherValue(this.publisher,"trc_preview_recommendations")).trc;if(this.trc.getProperty(this.mode_name,"list-size")>a["video-list"].video.length){return false}this.removeAnimation();this.generateVisibleParts();this.response={trc:a};this.drawList=true;this.reqParams.req=this.response.trc.req;this.reqParams.sd=this.response.trc["session-data"];this.reqParams.uid=this.response.trc["user-id"];this.drawListBody(a);return true};TRCRBox.prototype.load=function(a){var c=this.trc.getProperty(this.mode_name,"loading-animation-url");if(this.loaded){return}var b=(this.reqParams["item-id"]!=null&&this.reqParams["item-id"].length!=0&&typeof this.reqParams["item-id"]!="undefined");if(this.loaderAnim==null&&c!="hide"){this.element.style.height="auto";this.listContainer.style.display="block";this.listContainer.parentNode.style.display="block";if(b){this.loaderAnim=this.genLoading()}}if(b){this.src=this.genRBoxURL();this.errorHandler=a;this.getData()}else{this.loaded=true}};TRCRBox.prototype.updateRecommendations=function(c,b,a){this.reqParams["item-id"]=c;this.reqParams["item-type"]=b;this.reqParams["item-url"]=a;this.reqParams.sd=(typeof PageManager=="undefined")?null:PageManager.getPublisherValue(window.trc_publisher_id,"session-data");this.reqParams.uid=(typeof PageManager=="undefined")?null:PageManager.getValue("user-id");this.retryCount=0;this.drawList=false;this.response=null;if(this.timeoutId){window.clearTimeout(this.timeoutId);this.timeoutId=null}this.loaded=false;this.trc.renderRBox(this);return true};TRCRBox.prototype.isVisible=function(){function a(j,i){if(!j.parentNode||j.parentNode==document.documentElement&&j!=i){return false}return j==i||a(j.parentNode,i)}var f=this.element.getBoundingClientRect();var d=f.left+Math.round((f.right-f.left)/2),b=f.top+Math.round((f.bottom-f.top)/2);var h=document.compatMode==="CSS1Compat"&&document.documentElement.clientWidth||document.body.clientWidth;var g=document.compatMode==="CSS1Compat"&&document.documentElement.clientHeight||document.body.clientHeight;var c=(__trcBrowser.operaUpto(10.1)||__trcBrowser.safariUpto(4))?document.elementFromPoint(d+document.body.scrollLeft,b+document.body.scrollTop):document.elementFromPoint(d,b);return d>0&&d<h&&b>0&&b<g&&c&&a(c,this.element)};TRCRBox.prototype.clearChilds=function(a){while(a.hasChildNodes()){a.removeChild(a.lastChild)}};TRCRBox.prototype.addSyndicatorLogo=function(){if(this.syndicator&&typeof TRCobj.global!="undefined"){var f=this.header;var d=TRCobj.global[this.syndicator+"-syndication-branding-url"];if(typeof d!="undefined"&&d!=""){var a=document.createElement("div");a.className="branding_div";var c=document.createElement("img");c.className="branding_img";c.display="block";c.style.border="0";c.style.visibility="hidden";c.style.position="absolute";var b="";if(__trcBrowser.ieUpto(8)){b="?id="+parseInt(Math.random()*10000)}c.src=d+b;if(TRCobj.direction=="ltr"){a.style.textAlign="right"}else{a.style.textAlign="left"}a.style.height="auto";c.onload=function(){var h=Math.max(self.listContainer.clientWidth,self.listContainer.parentNode.clientWidth)-header_span.offsetWidth;if(Math.max(header_span.scrollHeight,header_span.offsetHeight)<=0){header_span.innerHTML="&nbsp;"}var g=Math.max(f.clientHeight,f.scrollHeight,header_span.scrollHeight);a.style.height=this.height+"px";if(this.width>h){this.style.width=Math.max(h-5,0)+"px";a.style.height=this.style.height="auto"}if(g<this.height){this.style.width="auto";this.height=g;a.style.height=this.style.height=g+"px"}this.style.position="relative";this.style.visibility="visible";f.style.minHeight=this.clientHeight+"px"};a.appendChild(c);this.header.ext.insertBefore(a,this.header.ext.firstChild)}}};TRCRBox.prototype.addSyndicatorLink=function(c,b){if(this.syndicator){return false}if(b.innerHTML==""||typeof this.trc.global=="undefined"||typeof this.trc.global[this.syndicator+"-syndication-main-link"]=="undefined"){return false}var a=document.createElement("a");a.className="trc-syndication-link";a.href=this.trc.global[this.syndicator+"-syndication-main-link"];a.target="blank";a.appendChild(b);c.appendChild(a);return true};TRCRBox.prototype.hasSyndicated=function(c){var a=0,b;for(;b=c[a];a++){if(b["is-syndicated"]){return true}}};TRCRBox.prototype.on=(function(){if(window.addEventListener){return function(b,c,a){b.addEventListener(c,a,false)}}else{if(window.attachEvent){return function(b,c,a){b.attachEvent("on"+c,a)}}else{return function(b,c,a){__trcAttachEvent(b,c,a)}}}}());TRCRBox.prototype.rePositionDurationElement=function(c,b,a){if(__trcBrowser.ieUpto(6)){c.style.marginLeft=(b/2-3)+"px";c.style.top=(a/2-15)+"px"}else{if(__trcBrowser.ie===7){c.style.left=(b-3)+"px";c.style.top=(a-15)+"px"}else{c.style.marginLeft=(b-3)+"px";c.style.top=(a-15)+"px"}}};TRCRBox.prototype.getFirstVideoItem=function(b){var d=0,c=b.boxes,a=null;for(d=0;d<c.length;d++){if(!c[d].video_data.isAd&&!c[d].video_data["is-syndicated"]){a=c[d].video_data;break}}return a};TRCRBox.prototype.hasDuration=function(){var c,a=this.trc.getProperty(this.mode_name,"detail-order").split(",");for(var b=0;c=a[b];b++){if(c=="duration"){return true}}};TRCRBox.prototype.cleanStyleDimensions=function(a){var c=null;try{__trcDOMWalker(a,function(d){if(d.style.cssText){d.style.width="";d.style.height=""}if((d.className+"").indexOf("video-duration")!==-1){c=d}})}catch(b){}return c};TRCRBox.prototype.createBillboard=function(){var b=__trcGetElementsByClass("trc_rbox_outer","div",this.element)[0];if(!b){return null}var a=document.createElement("div");this.billboard=a;a.className="trc_billboard";a.style.width="auto";b.parentNode.insertBefore(a,b);b.style.clear="both";return a};TRCRBox.prototype.createEmbedThumb=function(b){var l=this["player-container-id"]&&document.getElementById(this["player-container-id"]),k=this.trc.getProperty(this.mode_name,"player-detail-order"),g=document.createElement("DIV"),d=this.trc.getProperty(this.mode_name,"render-player-info"),f,i,j,h=this,a=this.trc.getProperty(this.mode_name,"player-thumbnail-height")||300,c=this.trc.getProperty(this.mode_name,"player-thumbnail-width")||400;b=b||this.getFirstVideoItem(this);if(!b){__trcError("outerbox.js: video item was not found");return}l=l||this.createBillboard();if(!l){__trcError("Can't find container element for createEmbedThumb!");return}l.innerHTML="";l.className+=" "+this.mode_name;l.hasDuration=this.hasDuration();g.style.height="100%";g.style.cssFloat="left";g.className="playerCube";l.appendChild(g);f=this.drawVideoBox(b,l.hasDuration,k,"top");g.appendChild(f);j=f.getElementsByTagName("A");if(d){f.fixTextOverflow()}else{if(j[1]){j[1].parentNode.removeChild(j[1])}}if(f.thumb&&f.img&&f.img_src){f.thumb.appendChild(f.img);f.img.onload=(function(){var m=d?c:f.clientWidth,n=d||this.billboard?a:f.clientHeight;if(!(f.img.offsetWidth+f.img.offsetHeight)){setTimeout(function(){m=d?c:f.clientWidth,n=d||this.billboard?a:f.clientHeight;h.FixVideoImage(m,n,f.img)},10)}else{this.FixVideoImage(m,n,f.img)}}).trcBind(this);i=this.cleanStyleDimensions(f);f.style.marginLeft="0";f.style.width="auto";f.style.height="100%";f.style.cssFloat="none";f.style.styleFloat="none";f.thumb.style.width=(d||this.billboard)?c+"px":"100%";f.thumb.style.height=d||this.billboard?a+"px":"100%";f.thumb.style.marginRight="0";f.thumb.style.position="relative";f.img.src=this.getThumbnailURL(b,f.thumb.offsetWidth,f.thumb.offsetHeight);if(__trcBrowser.ieUpto(6)){f.onmouseover=function(){this.className+=" playerCube_hover"};f.onmouseout=function(){this.className=this.className.replace(/\b\s+playerCube_hover\b/g,"")}}l.videoBlock=j[0];j[0].onclick=(function(n){var m=this.trc.getProperty(this.mode_name,"player-embed-code");n=n||event;if(typeof m=="function"&&l&&!window.trc_testmode){this.playInsideHostingContainer(b,m,l)}else{window.open(b.logger_url)}if(n.preventDefault){n.preventDefault()}return n.returnValue=false}).trcBind(this);f.visCheckDone=true;if(i){this.rePositionDurationElement(i,f.thumb.clientWidth,f.thumb.clientHeight)}}};TRCRBox.prototype.drawListBody=function(trc,delayCount){if(typeof trc!="object"){return}delayCount=(delayCount||0);var listContainer=this.listContainer;this.boxes=[];this.visible_boxes=[];var internalc_width=0;var TRCobj=this.trc;if(typeof trc["test-variant"]!="undefined"){if(typeof this.trc.modes["ab_"+this.mode_name+"_"+trc["test-variant"]]!="undefined"){this.mode_name="ab_"+this.mode_name+"_"+trc["test-variant"];this.element.className="trc_rbox "+this.mode_name}}this.injectQuantcast();var rbox_css_loaded=document.getElementById("trc_rbox_css_loaded");if(rbox_css_loaded==null){rbox_css_loaded=document.createElement("div");rbox_css_loaded.id="trc_rbox_css_loaded";this.element.parentNode.parentNode.appendChild(rbox_css_loaded)}if(document.trcGetCurrentStyle(rbox_css_loaded,"overflow")!="hidden"){if(delayCount<2){__trcWarn("rbox.css not loaded "+(delayCount+1)+" time(s)")}if(delayCount<10){window.setTimeout(this.drawListBody.trcBind(this,trc,delayCount+1),500);return}__trcWarn("rbox.css failed to load!")}delayCount=(delayCount||0);if(typeof Gettext=="undefined"||typeof this.trc.gt.domain=="undefined"){if(delayCount<2){__trcWarn("Gettext.js not loaded "+(delayCount+1)+" time(s)")}if(delayCount<10){window.setTimeout(this.drawListBody.trcBind(this,trc,delayCount+1),500);return}__trcWarn("Gettext.js failed to load!")}var videos=trc["video-list"].video;if(typeof videos=="undefined"){return}if(!(videos instanceof Array)){videos=[videos]}this.recommendationList=videos;this.hasSyndicatedContent=this.hasSyndicated(this.recommendationList);function autoHeight(elm){var oldVal=parseInt(document.trcGetCurrentStyle(elm,"height"));if(isNaN(oldVal)){return true}var p=document.createElement("span");with(p.style){display="block";height="10px";width="10px"}elm.appendChild(p);var newVal=parseInt(document.trcGetCurrentStyle(elm,"height"));elm.removeChild(p);return(newVal!=oldVal)}function setHeight(elm,height){elm.style.height=height+"px";var factor=0;while(elm.clientHeight>height){elm.style.height=(height-(++factor))+"px"}}var has_duration_label=false;var self=this;var detail_order=this.trc.getProperty(this.mode_name,"detail-order");var orientation=this.trc.getProperty(this.mode_name,"orientation");detail_order=detail_order.split(",");for(var i=0;i<detail_order.length;i++){if(detail_order[i]=="duration"){has_duration_label=true}}var explore_delay=0;this.exploreTimeoutId=null;if(typeof this.trc.global!="undefined"){explore_delay=this.trc.global["explore-delay"]}var self=this;listContainer.onmouseover=(function(e){var element;if(window.event){element=window.event.srcElement}else{if(e){element=e.target}}if(element!=this.listContainer&&this.exploreTimeoutId!=null){return}this.exploreTimeoutId=window.setTimeout((function(){this.sendEvent("explore",{},true)}).trcBind(this),explore_delay)}).trcBind(this);if(explore_delay!=0){listContainer.onmouseout=(function(e){var posx=0;var posy=0;if(!e){var e=window.event}var dimentions=this.listContainer.getBoundingClientRect();if((e.clientX>=dimentions.left&&e.clientX<dimentions.right)&&(e.clientY>=dimentions.top&&e.clientY<dimentions.bottom)){return}if(this.exploreTimeoutId){window.clearTimeout(this.exploreTimeoutId);this.exploreTimeoutId=null}}).trcBind(this)}var internalc=document.createElement("div");internalc.id="internal_"+this.id;while(listContainer.firstChild){listContainer.removeChild(listContainer.firstChild)}listContainer.appendChild(internalc);if(listContainer.style.display=="none"||listContainer.parentNode.style.display=="none"){this.listContainer.style.display="block";this.listContainer.parentNode.style.display="block"}var trcmeta={};__trcCopyProps(trc,trcmeta);delete trcmeta["video-list"];internalc.meta=trcmeta;this.firstVideo=null;var listSize=TRCobj.getProperty(this.mode_name,"list-size");listSize=Math.min(listSize,videos.length);if(orientation=="horizontal"){listContainer.style.overflowY="hidden";listContainer.style.overflowX="auto";internalc.style.width="5000px"}else{listContainer.style.overflowX="hidden";listContainer.style.overflowY="auto"}for(var i=0;i<listSize;i++){var cur=videos[i];if(this.firstVideo==null&&cur.type=="video"){this.firstVideo=cur}try{this.trc.getFunction(this.mode_name,"item-data-filter",cur);var box=this.drawVideoBox(cur,has_duration_label);if(orientation=="vertical"){var clear_div=document.createElement("div");clear_div.style.clear="both";box.appendChild(clear_div)}if(TRCobj.getProperty(this.mode_name,"navigation-type")!="scrolling"){internalc.appendChild(box);if(box.offsetHeight>listContainer.offsetHeight){var diff=box.offsetHeight-listContainer.offsetHeight;box.style.height=parseInt(document.trcGetCurrentStyle(box,"height"))-diff+"px"}internalc.removeChild(box)}else{internalc.appendChild(box);box.fixTextOverflow();if(!box.video_data.isAd){if(typeof box.image_div=="undefined"){box.thumb.appendChild(box.img)}else{box.thumb.appendChild(box.image_div);box.image_div.appendChild(box.img)}box.img.src=box.img_src;if(!box.video_data["is-syndicated"]&&this.is_box_visible(box)){this.visible_boxes.push(box.video_data["item-id"])}}var mrg_right=parseInt(document.trcGetCurrentStyle(box,"margin-right"));internalc_width=box.clientWidth+box.offsetLeft+(isNaN(mrg_right)?0:mrg_right);if(orientation=="horizontal"&&autoHeight(box)){setHeight(box,listContainer.offsetHeight)}}this.boxes.push(box)}catch(e){__trcError("Error in drawVideoBox",e)}}var pager_interval=null,pager_interval_func=null;if(TRCobj.getProperty(this.mode_name,"navigation-type")!="scrolling"){internalc.style.width="auto";var my_filesAdded=TRC.filesAdded;pager_interval_func=function(){var pagerDiv=self.drawPager();var auto=TRCobj.getProperty(self.mode_name,"auto-scroll");if(typeof auto!="undefined"&&typeof pagerDiv!="undefined"){if(auto!="none"){self.auto_scroll=function(){var auto_index=0;for(i=0;i<pagerDiv.pages.length;i++){if(pagerDiv.pages[i]==pagerDiv.current){if(i!=(pagerDiv.pages.length-1)){auto_index=++i;break}}}pagerDiv.pages[auto_index].page_switch()};if(self.auto_scroll_interval!=null){window.clearInterval(self.auto_scroll_interval)}self.auto_scroll_interval=window.setInterval(self.auto_scroll,parseInt(auto))}}try{if(typeof my_filesAdded.css!="undefined"&&pager_interval!=null){window.clearInterval(pager_interval)}}catch(e){__trcError("Error in rbox.css loading detection",e);window.clearInterval(pager_interval)}};try{if(typeof my_filesAdded.css=="undefined"){pager_interval=window.setInterval(pager_interval_func,100)}else{pager_interval_func()}}catch(e){__trcError("Error in rbox.css loading detection",e);pager_interval_func()}}else{internalc.style.width=internalc_width+"px";if(__trcBrowser.ieUpto(6)&&listContainer.parentNode.parentNode.clientWidth*1.1<listContainer.clientWidth){listContainer.style.width="99%"}(function(attr){if(listContainer["client"+attr]+1>=listContainer["scroll"+attr]){return}if(__trcBrowser.ie&&__trcBrowser.ie<8){listContainer.style[attr.toLowerCase()]=internalc["client"+attr]+18+"px";if(attr=="Width"){this.element.style.width=listContainer.style[attr.toLowerCase()]}return}var step=Math.floor(Math.max(1,(listContainer["scroll"+attr]-listContainer["client"+attr])));step-=Math.max(0,listContainer["scroll"+attr]-listContainer.parentNode["scroll"+attr]);var oldVal=parseInt(listContainer.style[attr.toLowerCase()]);var targetWidth=(Math.max(listContainer["scroll"+attr],isNaN(oldVal)?0:oldVal)+step)+"px";listContainer.style[attr.toLowerCase()]=targetWidth;if(attr=="Width"){this.element.style.width=targetWidth}this.postRenderQueue.pushFront("adapt to scrollbar",arguments.callee.trcBind(this,attr))}).call(this,(TRCobj.getProperty(this.mode_name,"orientation")=="horizontal")?"Height":"Width");if(TRCobj.getProperty(this.mode_name,"shade-scroll")){this.postRenderQueue.pushBack("drawShade",(function(o){this.drawShade(o)}).trcBind(this,orientation))}listContainer.onscroll=(function(){this.sendEvent("explore",{},true);this.check_visibility()}).trcBind(this);this.check_visibility()}if(this.hasSyndicatedContent){this.postRenderQueue.pushBack("syndication hint icon",this.addSyndicationHintIcon.trcBind(this,internalc))}if("embed"===this.link_target){this.postRenderQueue.pushBack("createEmbedThumb",this.createEmbedThumb.trcBind(this))}this.postRenderQueue.pushBack("list-suffix,publisher-end",function(internalc){this.trc.getFunction(this.mode_name,"list-suffix",internalc,this);this.trc["publisher-end"](this.id)}.trcBind(this,internalc));this.postRender();this.sendEvent("available",{},true);(function(){if(this.isVisible()){this.sendEvent("visible",{il:this.visible_boxes.join(",")},true);this.trc.getFunction(this.mode_name,"after-visible",internalc,this)}else{window.setTimeout(arguments.callee.trcBind(this),1000)}}).trcBind(this)();var active=this.trc.getProperty(this.mode_name,"auto-advance");if(active!=-1&&typeof active!="undefined"){if(this.autoPlayer==null){this.autoPlayer=this.startAutoPlayManager(this.firstVideo,active)}else{this.autoPlayer.getPlaylistItem("n")}}};TRCRBox.prototype.postRender=function(b){if(b){var a=this.postRenderQueue.popFront();if(a==null){__trcInfo("TRCRBox.postRender: finished");return}__trcInfo("TRCRBox.postRender: executing "+a.name);try{a.func.call(this)}catch(c){__trcError("Error in TRCRBox.postRender while executing "+a.name,c)}}window.setTimeout(this.postRender.trcBind(this,true),0)};TRCRBox.prototype.addSyndicationHintIcon=function(f){var a=this.trc.getProperty(this.mode_name,"syndicated-attribution"),d=this.trc.getProperty(this.mode_name,"syndicated-attribution-tooltip"),h=this.trc.getProperty(this.mode_name,"syndicated-attribution-position"),c=document.createElement("a"),b=/\btrc_rbox\b/,g="http://services.taboolasyndication.com/publisher/"+this.publisher+"/rbox?service=info&topic=synd";c.href="#about_syndication";c.appendChild(document.createTextNode(a));c.title=d;c.style.display="block";c.className="whatsThisSyndicated a-"+h;this.syndicatedAttributionElement=c;while(!b.test(f.className)){f=f.parentNode}f.appendChild(c);if("absolute"!==f.style.position){f.style.position="relative"}this.on(c,"click",function(i){i=i||event;i.returnValue=false;i.cancelBubble=true;if(i.stopPropagation){i.stopPropagation()}if(i.preventDefault){i.preventDefault()}window.open(g,"aboutSyndication","location=0, width=330, height=410, resizable=0, status=0, menubar=0, toolbar=0, titlebar=0, scrollbars=0")})};TRCRBox.prototype.injectQuantcast=function(){var a=this.trc.getProperty(this.mode_name,"quantcast-label");if(a){if(typeof __qc==="undefined"){window._qevents=window._qevents||[];this.trc.loadExternal((document.location.protocol=="https:"?"https://secure":"http://edge")+".quantserve.com/quant.js","js")}window._qevents.push({qacct:"p-82ntF_h97O-3c",labels:a})}};TRCRBox.prototype.drawShade=function(b){if(__trcBrowser.ie&&__trcBrowser.ie<=6){return}var c=this.listContainer["client"+(b=="vertical"?"Width":"Height")]+"px";var d=(this.listContainer["client"+(b=="vertical"?"Height":"Width")]+this.listContainer["client"+(b=="vertical"?"Top":"Left")]-10)+"px";var f=document.createElement("div");f.className=b+"-start-shade";f.style[b=="vertical"?"width":"height"]=c;f.style["margin"+(b=="vertical"?"Top":"Left")]=this.listContainer["client"+(b=="vertical"?"Top":"Left")]+"px";var a=document.createElement("div");a.className=b+"-end-shade";a.style[b=="vertical"?"width":"height"]=c;this.listContainer.parentNode.insertBefore(f,this.listContainer);this.listContainer.parentNode.insertBefore(a,this.listContainer);a.style["margin"+(b=="vertical"?"Top":"Left")]=d;a.style.backgroundRepeat=f.style.backgroundRepeat="repeat-"+(b=="vertical"?"x":"y")};TRCRBox.prototype.drawPager=function(){var v=this.trc;var S=v.getProperty(this.mode_name,"pager-type-style");var s=v.getProperty(this.mode_name,"cyclical-paging");var g=v.getProperty(this.mode_name,"pager-position");var d=v.getProperty(this.mode_name,"pager-button-location");var o=v.getProperty(this.mode_name,"pager-button-style");var I=this.mode_name;var A=this.listContainer;var w=v.getProperty(I,"orientation");var G=A.firstChild;function D(){var U=new Array();var T=0;var i=0;for(L=0;L<this.boxes.length;L++){var V=this.boxes[L];G.appendChild(V);V.fixTextOverflow(true);if(w=="vertical"){if((G.offsetHeight-5)>=A.clientHeight){G.removeChild(V);U[T++]={start_index:i,end_index:((L-1)<i)?i:L-1};if((L-1)>=i){i=L--}else{i=L}this.clearChilds(G)}}else{if(((A.clientHeight*1.1))<A.scrollHeight){G.removeChild(V);U[T++]={start_index:i,end_index:((L-1)<=i)?i:L-1};if((L-1)>=i){i=L--}else{i=L}this.clearChilds(G)}}}U[T]={start_index:i,end_index:L-1};this.clearChilds(G);return U}this.clearChilds(G);A.style.overflowX="hidden";A.style.overflowY="hidden";var k=D.call(this);var B=document.createElement("div");B.style.clear="both";this.visible_boxes=[];for(var L=k[0].start_index;L<=k[0].end_index;L++){if(L>=this.boxes.length){continue}var f=this.boxes[L];G.appendChild(f);if(f.video_data.isAd){if(f.img_src!=null){f.video_data.ad_load_count=new Date().getTime();f.thumb.appendChild(f.img);f.img.src=f.img_src;if(f.spnoverlay!=null){var M=f.spnoverlay;var t=M.firstChild;var z=M.lastChild;var n=z[(z.clientHeight>0?"client":"scroll")+"Height"];t.style.width=z[(z.clientWidth>0?"client":"scroll")+"Width"]+"px";M.style.height=t.style.height=Math.max(n,parseInt(t.style.height))+"px"}f.img_src=null}}else{try{if(f.img_src!=null){if(typeof f.image_div=="undefined"){f.thumb.appendChild(f.img)}else{f.thumb.appendChild(f.image_div);f.image_div.appendChild(f.img)}f.img.src=f.img_src;f.img_src=null}}catch(N){__trcError("Pager thumbnail images fixing errors",N)}if(!f.video_data["is-syndicated"]){this.visible_boxes.push(f.video_data["item-id"])}}f.fixTextOverflow()}G.appendChild(B);var l=this.pager;if(l!=null){try{l.parentNode.removeChild(l)}catch(N){}}var Q=k.length;if(Q<=1||v.getProperty(this.mode_name,"navigation-type")=="none"){this.check_visibility();return}var c=document.createElement("div");c.style.position="absolute";c.style.width=(A.clientWidth/2)+"px";var O=document.createElement("div");c.appendChild(O);A.parentNode.appendChild(c);O.id="trc_pager_"+this.id;O.className="trc_pager";O.current=null;O.pages=new Array();O.curPage=0;var m=A.clientWidth;var J=document.createElement("div");J.id="pager_prev_"+this.id;J.className="trc_pager_prev";if(d=="sides"){J.style.width="auto";J.style.paddingTop=(A.clientHeight-J.clientHeight)/2+"px";J.style.position="absolute";J.style[(v.direction=="ltr")?"left":"right"]="0px";A.parentNode.insertBefore(J,A)}else{O.appendChild(J)}J.onclick=function(){if(O.curPage>0){O.pages[O.curPage-1].onclick()}else{if(s){O.pages[O.pages.length-1].onclick()}}};var r=document.createElement("div");r.id="pager_next_"+this.id;r.className="trc_pager_next";r.onclick=function(){if(O.curPage+1<O.pages.length){O.pages[O.curPage+1].onclick()}else{if(s){O.pages[0].onclick()}}};var F=v.getProperty(this.mode_name,"pager-button-inactive-image");var b=v.getProperty(this.mode_name,"pager-button-active-image");var q=v.getProperty(this.mode_name,"pager-button-hover-image");if(d!="none"){if(o=="image"){if(F!=""){J.image=document.createElement("img");if(d=="sides"){J.image.onload=function(){A.style.paddingLeft=A.style.paddingRight=this.clientWidth+"px"}}J.image.src=F;J.appendChild(J.image);r.image=document.createElement("img");if(d=="sides"){r.image.onload=function(){A.style.paddingLeft=A.style.paddingRight=this.clientWidth+"px";this.style[(v.direction=="ltr")?"left":"right"]=m-this.clientWidth+"px"}}r.image.src=o;r.appendChild(r.image);J.onmouseover=function(){this.before_image=this.image.src;if(q!=this.image.src){this.image.src=q}};J.onmouseout=function(){if(typeof this.before_image!="undefined"){if(this.before_image!=this.image.src){this.image.src=this.before_image}}};r.onmouseover=function(){this.before_image=this.image.src;if(q!=this.image.src){this.image.src=q}};r.onmouseout=function(){if(typeof this.before_image!="undefined"){if(this.before_image!=this.image.src){this.image.src=this.before_image}}}}else{J.innerHTML="&lt;";r.innerHTML="&gt;"}}else{var u=o.split("|");btn_prev=u[0];btn_next=u[1];J.innerHTML=btn_prev;r.innerHTML=btn_next}}else{J.style.display="none";r.style.display="none"}var j=document.createElement("div");j.className="trc_pager_pages";O.appendChild(j);var K=v.getProperty(this.mode_name,"pager-style-active-image");var E=v.getProperty(this.mode_name,"pager-style-inactive-image");var H=v.getProperty(this.mode_name,"pager-style-hover-image");for(var L=0;L<Q;L++){var a=document.createElement("div");switch(S){case"none":a.innerHTML="";j.style.cssText="display:none !important;";break;case"numbers":a.innerHTML=""+(L+1);break;case"counter":var y=document.createElement("span");y.className="trc_pager_counter";y.innerHTML=Gettext.strargs(v.gt.gettext("%1 of %2"),[(L+1),O.pages.length]);a.appendChild(y);if(j.className.search("trc_pager_counter")<0){j.className+=" trc_pager_counter"}break;case"bullets":a.innerHTML='<span style="font-weight: bold;">&bull;</span>';break;case"image":if(K!=""){a.inner_img=document.createElement("img");a.inner_img.src=E;a.appendChild(a.inner_img)}else{a.innerHTML=""+(L+1)}break}a.className="trc_pager_unselected";j.appendChild(a);a.index=L;var h=this;a.page_switch=function(){try{G.removeChild(B)}catch(Y){}if(O.current!=null){if(S=="image"){if(E!=""){a.inner_img.src=E}}O.current.className="trc_pager_unselected";for(L=k[O.curPage].start_index;L<=(k[O.curPage].end_index);L++){if(L<h.boxes.length){G.removeChild(h.boxes[L])}}for(L=k[this.index].start_index;L<=k[this.index].end_index;L++){if(L>=h.boxes.length){continue}var X=h.boxes[L];G.appendChild(X);if(typeof X.img!="undefined"){if(X.img_src!=null){X.video_data.ad_load_count=new Date().getTime();if(typeof X.image_div=="undefined"){X.thumb.appendChild(X.img)}else{X.thumb.appendChild(X.image_div);X.image_div.appendChild(X.img)}X.img.src=X.img_src;X.img_src=null}}if(X.spnoverlay!=null){var U=X.spnoverlay;var W=U.firstChild;var V=U.lastChild;var T=V[(V.clientHeight>0?"client":"scroll")+"Height"];W.style.width=V[(V.clientWidth>0?"client":"scroll")+"Width"]+"px";U.style.height=W.style.height=Math.max(T,parseInt(W.style.height))+"px";X.spnoverlay=null}X.fixTextOverflow();h.postRender()}}G.appendChild(B);O.current=this;if(S=="image"){if(K!=""){a.inner_img.src=K}}this.className="trc_pager_selected";O.curPage=this.index;if(typeof r!="undefined"){if((this.index+1>=O.pages.length)&&(!s)){if(F!=""&&d!="none"){r.image.src=F}r.className="trc_pager_next pager_disabled"}else{if(b!=""&&d!="none"){r.image.src=b}r.className="trc_pager_next pager_enabled"}}if(typeof J!="undefined"){if(this.index<=0&&(!s)){if(F!=""&&d!="none"){J.image.src=F}J.className="trc_pager_prev pager_disabled"}else{if(b!=""&&d!="none"){J.image.src=b}J.className="trc_pager_prev pager_enabled"}}if(S=="counter"){var i=document.createElement("div");i.appendChild(document.createTextNode(Gettext.strargs(v.gt.gettext("%1 of %2"),[(this.index+1),O.pages.length])));while(j.firstChild){j.removeChild(j.firstChild)}j.appendChild(i)}h.check_visibility()};a.onclick=function(){this.page_switch();if(this.index!=0){h.sendEvent("explore",{},true)}};a.onmouseover=function(){if(S=="image"){if(H!=""){this.prev_img=this.inner_img.src;this.inner_img.src=H}}};a.onmouseout=function(){if(S=="image"){if(typeof this.prev_img!="undefined"){this.inner_img.src=this.prev_img}}};O.pages.push(a)}if(d=="sides"){r.style.width="auto";r.style.paddingTop=(A.clientHeight-r.clientHeight)/2+"px";r.style.position="absolute";A.parentNode.insertBefore(r,A);A.style.paddingLeft=A.style.paddingRight=r.clientWidth+"px";r.style[(this.trc.direction=="ltr")?"left":"right"]=m+r.clientWidth+"px"}else{O.appendChild(r)}O.pages[0].onclick();this.pager=O;if(g=="center"){O.style.position="absolute";O.style.cssFloat="none";O.style.styleFloat="none";O.style.display="block";var x=O.clientWidth;O.style.width=(x+2)+"px";O.style.position="relative";var P=((A.clientWidth-x)/2);O.parentNode.style.width=(x+2+P)+"px";O.style.marginLeft=P+"px"}else{if(g=="header"){if(this.header.ext){O.parentNode.removeChild(O);O.className+=" in_trc_header";var R=document.createElement("div");R.appendChild(O);R.id=O.id;O.id="";var C=document.createElement("div");C.style.clear="left";R.appendChild(C);if(!this.header.titleBox.innerHTML){this.header.titleBox.innerHTML="&nbsp;"}this.header.ext.appendChild(R)}}}return O};TRCRBox.prototype.check_visibility=function(){for(var f=0;f<this.boxes.length;f++){var g=this.boxes[f];if(g.visCheckDone){continue}if(!this.is_box_visible(g)){continue}if(!g.video_data.isAd){continue}g.video_data.ad_load_count=new Date().getTime();if(g.thumb&&g.img&&g.img_src){g.thumb.appendChild(g.img);g.img.src=g.img_src}if(typeof g.onvisible=="function"){g.onvisible()}if(g.spnoverlay!=null){var b=g.spnoverlay;var d=b.firstChild;var c=b.lastChild;var a=c[(c.clientHeight>0?"client":"scroll")+"Height"];d.style.width=c[(c.clientWidth>0?"client":"scroll")+"Width"]+"px";b.style.height=d.style.height=Math.max(a,parseInt(d.style.height))+"px";g.spnoverlay=null}g.visCheckDone=true}};TRCRBox.prototype.startAutoPlayManager=function(f,d){if(typeof this.autoplaybox!="object"){return null}var b=this.autoplaybox;var a=document.createElement("div");b.playerbox=a;b.appendChild(a);var c=new TRCAutoPlaylistController(this,this.publisher,null,b,f,this.listContainer.id,d);c.render(a);return c};TRCRBox.prototype.playInsideHostingContainer=function(c,b,j){var d=this.trc.getProperty(this.mode_name,"render-player-info"),a,f,h,i=this.trc.getProperty(this.mode_name,"player-detail-order"),g;if(j.videoBlock){if("A"===j.videoBlock.tagName.toUpperCase()){a=this.trc.getProperty(this.mode_name,"player-thumbnail-height")||300;j.videoBlock.parentNode.replaceChild(g=document.createElement("DIV"),j.videoBlock);j.videoBlock=g;j.videoBlock.style.height=d?a+"px":"";j.videoBlock.style.overflow="hidden";if(d){j.videoBlock.style.width=(this.trc.getProperty(this.mode_name,"player-thumbnail-width")||400)+"px";j.videoBlock.style.height=(this.trc.getProperty(this.mode_name,"player-thumbnail-height")||300)+"px"}}__trcPurgeEventHandlers(j.videoBlock);j.videoBlock.innerHTML="";h=j.getElementsByTagName("A")[0];b.apply(null,[j.videoBlock,c]);if(d){f=this.drawVideoBox(c,j.hasDuration,i,"top");__trcPurgeEventHandlers(h);h.parentNode.replaceChild(f.getElementsByTagName("A")[1],h)}this.sendEvent("click",{ii:c["item-id"],it:c.type})}else{__trcError("Error opening autoPlayContainer",e)}};TRCRBox.prototype.openPlayer=function(h,d,k){var b=this.publisher;var a="";if(this.syndicator){a=this.syndicator+"-";b=this.syndicator}var f=this.trc.global[a+"auto-advance"];if(typeof f=="undefined"){f=-1}var g=this.trc.global["syndicator-affiliate-id"];if(typeof g=="undefined"){g=null}if(typeof window.trc_lightboxOpen=="function"){window.trc_lightboxOpen()}try{var c=new window.TRC.LightBoxManager(this.trc.getProperty(this.mode_name,"lightbox-display-title"),k,this.listContainer.id,this.trc.direction);c.createHeader(h.title,this.trc.global[this.syndicator+"-syndication-branding-url"]);var j=function(m,l){return d(m,l,g)};c.addElements({bottom:new TRCAutoPlaylistController(this,b,j,c,h,"rbox-lightbox",f)});c.open();this.sendEvent("click",{ii:h["item-id"],it:h.type})}catch(i){__trcError("Error opening autoPlayContainer",i)}};TRCRBox.prototype.findElement=function(b,f,a,g){if(typeof f=="undefined"){f=document}if(typeof a=="undefined"){a="*"}var d=f.getElementsByTagName(a);for(var c=0;c<d.length;c++){if(b(d[c])){return d[c]}}return g};TRCRBox.prototype.findFlash=function(a){var b=this.findElement(a,document,"embed");if(b){return b}return this.findElement(a,document,"object")};TRCRBox.prototype.pauseVideo=function(c){var a=this.findFlash(function(d){return typeof d.pauseVideo=="function"});try{if(a){a.pauseVideo(c)}}catch(b){__trcError("Error in pauseVideo",b)}if(typeof window.trc_pauseVideo=="function"){window.trc_pauseVideo(c)}};TRCRBox.prototype.playVideoAd=function(d,f,c,b){var a=this.findFlash(function(h){return typeof h.playVideoAd=="function"});try{if(a){a.playVideoAd(d.title,d["display-url"],d["landing-url"],d.url,f,c,d["item-id"],b)}}catch(g){__trcError("Error in playVideoAd",g)}};TRCRBox.prototype.createVideoLink=function(b,c){var a=document.createElement("a");a.title=c;b.link_target=this.link_target;if(b.type=="video-ad"){a.href="#";a.onmouseover=this.sendEvent.trcBind(this,"discover",{ii:b["item-id"],it:b.type},true);a.onclick=(function(d){d=d||event;this.sendEvent("click",{ii:b["item-id"],it:b.type},false,this.playVideoAd.trcBind(this,b,this.reqParams.req,this.reqParams.sd,this.listContainer.id));if(d.preventDefault){d.preventDefault()}return d.returnValue=false}).trcBind(this)}else{if(b.type=="text-ad"){a.href=b.logger_url;a.target="_blank";a.onmouseover=this.sendEvent.trcBind(this,"discover",{ii:b["item-id"],it:b.type},true);a.onclick=(function(d){if(window.event){d=window.event}this.pauseVideo("link");window.open(b.logger_url);if(d.preventDefault){d.preventDefault()}return d.returnValue=false}).trcBind(this)}else{if(b["is-syndicated"]){a.href=b.logger_url=b.logger_url.replace(new RegExp("(\\w{3,5}:\\/\\/)"+this.domain),"$1"+this.syndicationDomain).replace("&url=","&redir=");a.target="_blank";a.onclick=(function(d){d=d||event;this.pauseVideo("link");window.open(b.logger_url+"&p="+encodeURIComponent(b.publisher));if(d.preventDefault){d.preventDefault()}return d.returnValue=false}).trcBind(this)}else{a.href=b.logger_url;if(this.link_target!="blank"){a.target="_parent"}a.onclick=this.videoLinkClickHandler.trcBind(this,b)}}}return a};TRCRBox.prototype.videoLinkClickHandler=function(c,h,j){h=h||window.event;var a="";if(this.syndicator){a=this.syndicator+"-"}if(c.link_target=="lightbox"&&this.trc.global){var f=this.trc.global[a+"syndication-embed-code"];if(typeof f=="function"&&!window.trc_testmode){this.openPlayer(c,f,h)}else{window.open(c.logger_url)}return false}if(c.link_target=="embed"){var b=this.trc.getProperty(this.mode_name,"player-embed-code"),d=this["player-container-id"],i=this.billboard||document.getElementById(d);if(c.isAd){window.open(c.url)}else{if(typeof b=="function"&&i&&!window.trc_testmode){this.playInsideHostingContainer(c,b,i,this.mode_name)}else{window.open(c.logger_url)}}return false}if(c.link_target=="blank"){if(c.type=="video"){this.pauseVideo("link")}if(typeof j=="undefined"){window.open(c.logger_url)}else{window.open(c.url)}return false}function g(){if(c.clickTimeout){window.clearTimeout(c.clickTimeout);c.clickTimeout=null}else{if(c.clickTimeout==null){return}}if(typeof window.trc_videoSelected=="function"&&c.link_target=="local"){window.trc_videoSelected(c.id,c.url)}else{if(c.link_target=="brightcove"&&window.TRC.brightcove_playVideo(c.id)){}else{if(c.link_target=="ooyala"&&window.TRC.ooyala_playVideo(c.id)){}else{window.parent.location=c.url}}}}if(typeof j=="undefined"){this.sendEvent("click",{ii:c["item-id"],it:c.type},false,g);c.clickTimeout=window.setTimeout(g,3000)}else{if(j=="playlist"){g()}}if(h.preventDefault){h.preventDefault()}return h.returnValue=false};TRCRBox.prototype.add_span=function(d,c,a){var b=document.createElement("span");if(d!=null){b.className=d}if(c!=null){if(typeof c=="object"){b.appendChild(c)}else{b.innerHTML=c}}if(typeof a!="undefined"){a.appendChild(b)}return b};TRCRBox.prototype.genSponsoredLabel=function(f,a,c){var n=this.listContainer;var b=this.trc.getProperty(this.mode_name,"sponsored-location");if(!b.match(/^thumbnail/)){c.spnoverlay=null;return}var o=this.trc.getProperty(this.mode_name,"thumbnail-height");var d=this.trc.getProperty(this.mode_name,"thumbnail-width");var k=this.trc.getProperty(this.mode_name,"sponsored-link-text");var i=this.trc.getProperty(this.mode_name,"sponsored-video-text");try{var h=document.createElement("span");if(b=="thumbnail"){h.className="trc_sponsored_overlay_base"}else{h.className="trc_sponsored_overlay_base round"}var g=this.add_span("",null,n);g.className="trc_sponsored_overlay";if(typeof d!="undefined"&&b=="thumbnail"){h.style.width=d+"px";g.style.width=d+"px"}else{h.style.width="auto";g.style.width="auto"}a.appendChild(h);c.spnoverlay=h;var l=null;if(f.type=="video-ad"){l=this.add_span("sponsored",this.trc.gt.gettext(i),n)}else{if(f.type=="text-ad"){l=this.add_span("sponsored",this.trc.gt.gettext(k),n)}}if(l!=null){var q=(this.getFontSize(l)+1);var m=Math.ceil(q*1.29);n.removeChild(l);h.appendChild(g);h.appendChild(l);g.style.height=h.style.height=m+"px";l.style.lineHeight=Math.ceil(q*1.1)+"px";if(b=="thumbnail"){h.style.marginTop=(o-m)+"px"}else{if(b=="thumbnail-top"){h.style.marginTop="4px"}else{h.style.marginTop=(o-m)-4+"px"}}}}catch(j){__trcError("Error while generating sponsored label",j)}};TRCRBox.prototype.genBidiLabel=function(b,f,c){function a(i){var h=i.charCodeAt(0);if((1488<=h&&h<=1514)||(1536<=h&&h<=1791)){var g=document.createElement("bde");g.dir="rtl";g.innerHTML=i;return g}else{return null}}var d=a(f);if(d==null){d=f}return this.add_span("video-label "+c,d,b)};TRCRBox.prototype.buildLabelBox=function(d,f,b){var c,g;for(c=0;c<b.length;c++){g=b[c];switch(g){case"title":this.genBidiLabel(d,f.title,"video-title");break;case"uploader":if(typeof f.uploader!="undefined"){this.add_span("video-label video-uploader",this.formatData("uploader",f.uploader),d)}break;case"category":if(typeof f.category!="undefined"){this.add_span("video-label video-category",this.formatData("category",decodeURIComponent(f.category.split(";")[0].split("//")[0])),d)}break;case"views":this.add_span("video-label video-views",this.formatData("views",f.views),d);break;case"rating":this.add_span("video-label video-rating",this.formatData("rating",f.rating),d);break;case"description":if(f.isAd&&!f.description){break}var a=this.genBidiLabel(d,f.description,"video-description");a.title='"Description: '+this.removeHtmlTags(f.description)+'"';break;case"duration":if((typeof f.duration!="undefined")&&(f.duration!="")){this.add_span("video-label video-duration-detail",this.formatData("duration",f.duration),d)}break;case"branding":if(f["branding-text"]){this.add_span("branding",this.formatData("syndicator",f["branding-text"]),d)}else{if(f["branding-url"]){this.add_span("branding","<img src='"+f["branding-url"]+"'>",d)}}break;case"url":break;default:if(typeof f[g]!="undefined"&&f[g]){this.add_span("video-label video-"+g,this.formatData(g,f[g]),d)}}}};TRCRBox.prototype.FixVideoImage=function(g,i,d){if(d.height==0||d.width==0||(!d.complete)||__trcBrowser.ieUpto(6)){d.style.width=g+"px";d.style.height=i+"px";d.style.visibility="visible";return}var a=g/i;var f=d.width/d.height;if(a>f){var h=Math.floor(g/f);var j=Math.floor((i-h)/2);d.style.width=g+"px";if(j!=0){if(__trcBrowser.ieAtleast(8)){d.style.position="relative";d.style.top=j+"px"}else{d.style.marginTop=j+"px"}}}else{var c=Math.floor(i*f);var b=Math.floor((g-c)/2);d.style.height=i+"px";if(b!=0){if(__trcBrowser.ieAtleast(8)){d.style.position="relative";d.style.left=b+"px"}else{d.style.marginLeft=b+"px"}}}d.style.visibility="visible"};TRCRBox.prototype.trackAdLoaded=function(d,c){if(!!d["tracking-image"]){var a="http://trc.taboolasyndication.com/"+encodeURIComponent(window.trc_publisher_id)+"/log/"+this.reqParams.pv+"/tracking?"+["pi="+encodeURIComponent(this.reqParams["item-id"]),"ri="+this.reqParams.req?encodeURIComponent(this.reqParams.req):"","sd="+this.reqParams.sd?encodeURIComponent(this.reqParams.sd):"","ui="+this.reqParams.uid?encodeURIComponent(this.reqParams.uid):"","it="+d.type,"ii="+d["item-id"],"pt="+this.reqParams["item-type"],"li="+this.listContainer.id,"url="+encodeURIComponent(d["tracking-image"]),"id="+Math.floor(Math.random()*100)].join("&");var b=document.createElement("img");b.style.height="1px";b.style.width="1px";b.style.visibility="hidden";b.style.position="absolute";b.src=a;this.element.appendChild(b)}this.sendEvent("display",{ii:d["item-id"],it:d.type,p:d["is-syndicated"]?d.publisher:null},true)};TRCRBox.prototype.drawThumbnailLink=function(h,s,q,v,j){var a="";var g=this;if(!s){if((q.type=="video")&&(typeof q.duration!="undefined")&&(q.duration!="")&&(q.duration!="0")){a=this.genDuration(q.duration)}}var b=this.createVideoLink(q,v);if((typeof q["thumbnail-clickable"]!="undefined")&&(q["thumbnail-clickable"]=="false")){b.title="";b.style.cursor="default";b.onclick=function(y){return false}}var m=this.trc.getProperty(this.mode_name,"thumbnail-height");var n=this.trc.getProperty(this.mode_name,"thumbnail-width");var u=document.createElement("span");u.className="thumbBlock";if(typeof m!="undefined"){u.style.height=m+"px"}if(typeof n!="undefined"){u.style.width=n+"px"}var f=document.createElement("img");f.style.visibility="hidden";if(q.isAd){u.style.overflowX="hidden";u.style.overflowY="hidden";f.style.display="inline";f.onerror=function(){q.ad_load_count=new Date().getTime();this.onerror=null;this.src="http://cdn.taboolasyndication.com/taboola/logo.png"};f.onload=function(){q.ad_load_count=new Date().getTime()-q.ad_load_count;if(typeof n!="undefined"){if(this.width>n||this.width<=0){this.style.width=n+"px"}else{this.style.width=this.width+"px"}f.style.visibility="visible";var y=(n-parseInt(this.style.width))/2;this.style.paddingRight=y+"px";this.style.paddingLeft=y+"px"}u.style.overflowX="visible";u.style.overflowY="visible";g.trackAdLoaded(q,this.src.match("://([^/]+)")[1])};q.ad_load_count=null}else{var r=this.add_span("thumbnail-overlay",null,u);if(__trcBrowser.ieUpto(6)){r.style.display="none"}var o=this.trc.getProperty(this.mode_name,"emblem");var w=null;if(o!=null&&o!="null"&&(!__trcBrowser.ie||__trcBrowser.ieAtleast(7))){w=this.add_span("thumbnail-emblem",null,u);w.style.backgroundImage="url("+o+")"}if(typeof m!="undefined"){r.style.height=m+"px";if(w!=null){w.style.height=m+"px"}}if(typeof n!="undefined"){r.style.width=n+"px";if(w!=null){w.style.width=n+"px"}}f.onerror=(function(y){__trcWarn("Failed to load thumbnail "+y.src+" for item="+q["item-id"]+", loading default thumbnail instead");y.onerror=null;y.src=(this.trc.getProperty(this.mode_name,"default-thumbnail")!="undefined")?this.trc.getProperty(this.mode_name,"default-thumbnail"):""}).trcBind(this,f);f.onload=(function(y){if(y.complete){this.FixVideoImage(n,m,y)}else{window.setTimeout(arguments.callee.trcBind(this,y),1000)}}).trcBind(this,f);if(__trcBrowser.ie===7){h.image_div=document.createElement("div")}if(q["is-syndicated"]){var i=document.createElement("span");i.className="branding";if(q["branding-text"]){i.appendChild(document.createTextNode(this.formatData("syndicator",q["branding-text"])))}else{if(q["branding-url"]){var x=document.createElement("img");x.src=q["branding-url"];i.appendChild(x)}}u.style.position="relative";u.appendChild(i);var d=document.createElement("span");var t=this.trc.getProperty(this.mode_name,"syndicated-static-text");var c=this.trc.getProperty(this.mode_name,"syndicated-static-text-position");d.className="static-text "+c;if(t){d.appendChild(document.createTextNode(t))}u.appendChild(d);g.trackAdLoaded(q,this.src.match("://([^/]+)")[1])}}h.thumb=u;h.img=f;h.img_src=this.getThumbnailURL(q,n,m);if(a!=""){var l=document.createElement("div");l.className="video-duration video-duration-detail";l.style.left=0;if(typeof n!="undefined"){if(__trcBrowser.ieUpto(6)){l.style.marginLeft=(n/2-3)+"px";l.style.top=(m/2-15)+"px"}else{if(__trcBrowser.ie===7){l.style.left=(n-3)+"px";l.style.top=(m-15)+"px"}else{l.style.marginLeft=(n-3)+"px";l.style.top=(m-15)+"px"}}}l.appendChild(a);var k=this.genDuration(q.duration);k.style.opacity=1;k.style.filter="alpha(opacity=100)";k.style.backgroundColor="transparent";l.appendChild(k);u.appendChild(l)}b.appendChild(u);switch(j){case"bottom":u.style.cssFloat="none";u.style.styleFloat="none";u.style.display="block";u.style.width=n+"px";break;case"top":u.style.cssFloat="none";u.style.styleFloat="none";u.style.display="block";u.style.width=n+"px";break;case"end":u.style.cssFloat="right";u.style.styleFloat="right";break}return b};TRCRBox.prototype.drawVideoBox=function(z,B,n,a){var d=this.listContainer.id;var F="";var t=this.reqParams.req;var u=this.reqParams.sd;var k=this.reqParams.uid;var E={};__trcCopyProps(z,E);z=E;z.isAd=(z.type=="video-ad")||(z.type=="text-ad");var q=document.createElement("div");q.rbox=this;var s=(a||this.trc.getProperty(this.mode_name,"thumbnail-position"+(z.isAd?"-ad":"")));if(z.isAd&&(typeof s=="undefined"||s=="inherit")){s=this.trc.getProperty(this.mode_name,"thumbnail-position")}q.video_data=z;q.className="videoCube "+this.trc.getProperty(this.mode_name,"orientation")+" "+(z.isAd?"sponsored-":"origin-")+z.origin+" thumbnail_"+s+(z["is-syndicated"]?" syndicatedItem":"");var w=z.url;if(w.search(/\w{3,4}:\/\/trc.taboolasyndication.com/)==0){var v=w.split(/[\?&]/);for(var y=0;y<v.length;y++){if(v[y].split("=")[0]=="url"){w=decodeURIComponent(v[y].split("=")[1]);break}}}if(!z.isAd&&!z["is-syndicated"]){w=this.trc.getFunction(this.mode_name,"change-url",w,q);if(typeof PageManager=="function"){w=PageManager.fixRecommendationURL(w)}}z.url=w;var j=this.reqParams["item-id"];var o=this.reqParams["item-type"];var x=this.trc.getProperty(this.mode_name,"sponsored-link-text");var l=this.trc.getProperty(this.mode_name,"sponsored-video-text");if(this.syndicator&&typeof this.trc.global!="undefined"){if((typeof this.trc.global[this.syndicator+"-syndication-affiliate-link-parameter"]!="undefined")&&(typeof this.trc.global["syndicator-affiliate-id"]!="undefined")){var f=this.trc.global[this.syndicator+"-syndication-affiliate-link-parameter"].replace("{affiliate_id}",this.trc.global["syndicator-affiliate-id"]);if(w.search("\\?")>=0){w+="&"+f}else{w+="?"+f}}}z.logger_url="http://trc.taboolasyndication.com/"+encodeURIComponent(window.trc_publisher_id)+"/log/"+this.reqParams.pv+"/click?pi="+encodeURIComponent(j)+(t?"&ri="+encodeURIComponent(t):"")+(u?"&sd="+encodeURIComponent(u):"")+(k?"&ui="+encodeURIComponent(k):"")+"&it="+z.type+"&ii="+z["item-id"]+"&pt="+o+"&li="+d+"&url="+encodeURIComponent(w)+"&r="+Math.floor(Math.random()*100);if(z.isAd){F=this.trc.gt.gettext((z.type=="video-ad"?l:x)+":")}F+=z.title;var h=this.createVideoLink(z,F);z.link=h;var m=document.createElement("span");m.style.display="block";m.className="video-label-box";h.appendChild(m);q.appendChild(h);if(s=="none"){if(z.isAd){__trcAttachEvent(q,"onvisible",function(){this.video_data.ad_load_count=0;this.rbox.trackAdLoaded(z,"")})}}else{var c=this.drawThumbnailLink(q,B,z,F,s);if(s=="bottom"){q.appendChild(c)}else{q.insertBefore(c,h)}}var b=n||this.trc.getProperty(this.mode_name,z.isAd?"detail-order-ad":"detail-order"+(z["is-syndicated"]?"-syndicated":""));b=b.split(",");if(z.isAd){if(s!="none"){this.genSponsoredLabel(z,q.thumb,q)}this.buildLabelBox(m,z,b);var r=w.match(new RegExp("^\\w{3,5}://([^/]+)/?"));if(r){r=r[1]}else{r=w.split("/")[0]}if(typeof z["display-url"]!="undefined"){r=z["display-url"]}var g=this.add_span("sponsored-url",r,h);if(s=="bottom"){g.style.cssFloat="none";g.style.styleFloat="none"}var D=this.trc.getProperty(this.mode_name,"sponsored-location");if(!D.match(/^thumbnail/)){var C=this.add_span("sponsored",this.trc.gt.gettext(z.type=="video-ad"?l:x));if(s=="end"){C.style.textAlign="left"}if(D=="top"){h.insertBefore(C,m)}else{h.appendChild(C);C.style.cssFloat="left";C.style.styleFloat="left";C.style.clear="both";C.style.width="100%";__trcAttachEvent(q,"onvisible",(function(G,i){i.style.marginTop=(q.clientHeight-i.offsetTop)+"px"}).trcBind(this,q,C))}}}else{this.buildLabelBox(m,z,b)}q.fixTextOverflow=this.fixBoxTitleAndDesc.trcBind(this,z,m);if(__trcBrowser.ieUpto(6)){q.onmouseover=function(){this.className+=" videoCube_hover"};q.onmouseout=function(){this.className=this.className.replace(/\b\s+videoCube_hover\b/g,"")}}try{if(!z.isAd||window.TRC.ads_use_renderer){this.trc.getFunction(this.mode_name,"item-renderer",q,q.video_data)}}catch(A){__trcError("Error in itemRenderer",A)}return q};TRCRBox.prototype.getThumbnailURL=function(d,c,f){if(typeof d["thumb-size"]=="undefined"){return d.thumbnail}var a=[{w:d["thumb-size"].split("x")[0],h:d["thumb-size"].split("x")[1],u:d.thumbnail}];for(var b=1;;b++){if(typeof d["thumb-size-"+b]=="undefined"){break}a.push({w:d["thumb-size-"+b].split("x")[0],h:d["thumb-size-"+b].split("x")[1],u:d["thumbnail-"+b]})}a=a.sort(function(h,g){return(h.w*h.h)-(g.w*g.h)});for(var b=0;b<a.length;b++){if(c*f<=a[b].w*a[b].h){return a[b].u}}return a.pop().u};TRCRBox.prototype.addTaboolaLogo=function(){var k=this.trc.attribution;var h=this.trc.getProperty(this.mode_name,"attribution-text");var f=this.trc.getProperty(this.mode_name,"logo-image");var d=this.trc.getProperty(this.mode_name,"attribution-position");var g="http://services.taboolasyndication.com/publisher/"+this.publisher+"/rbox?item-id="+this.reqParams["item-id"];if(k==false){return}var l=document.createElement("div");l.className="logoDiv";l.innerHTML="&nbsp;";if(this.trc.direction=="rtl"){l.style.cssFloat="left";l.style.styleFloat="left"}else{l.style.cssFloat="right";l.style.styleFloat="right"}var c=document.createElement("a");c.href=g;c.target="taboola";l.appendChild(c);if(d=="top"){if(typeof this.header=="object"){this.header.ext.appendChild(l)}}else{this.element.appendChild(l)}var j=document.createElement("div");var i="clear:both; _height:1px; _overflow:hidden;";if(typeof(j.style.cssText)=="string"){j.style.cssText=i}else{j.setAttribute("style",i)}this.element.appendChild(j);if(typeof f=="string"&&(h==null||h==""||h=="null")){if(__trcBrowser.ieUpto(6)){var b=document.createElement("span");b.style.width="45px";b.style.height="11px";b.backgroundImage="none";b.style.display="block";b.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+f+'")';c.appendChild(b)}else{var a=document.createElement("img");a.src=f;a.style.border="0";c.appendChild(a)}return}c.innerHTML+=h};TRCRBox.prototype.genDuration=function(b){var d=this.formatDuration(b);var a=document.createElement("dt");a.style.position="absolute";a.style.overflow="hidden";a.style.height="auto";a.style.width="auto";a.style.zIndex=48;a.style.right=0;var c=document.createElement("div");c.style.zIndex=50;c.style.paddingLeft="4px";c.style.paddingRight="4px";c.innerHTML=d;a.appendChild(c);return a};TRCRBox.prototype.fixBoxTitleAndDesc=function(c,b,a){if(!a){this.postRenderQueue.pushBack("fixBoxTitleAndDesc",this.fixBoxTitleAndDesc.trcBind(this,c,b,true));return}try{this.fixBoxOverflow(this.findElement(function(f){return f.className.search("title")>=0},b,"span",null),c.title,false,c["truncate-title"]!="false");this.fixBoxOverflow(this.findElement(function(f){return(f.className.search("description")>=0)},b,"span",null),c.description,true,true)}catch(d){__trcError("Problem in fixTextOverflow",d)}};TRCRBox.prototype.fixBoxOverflow=function(h,c,l,g){if(h==null){return}if(h.clientHeight<=0||h.clientWidth<=0){return}if(typeof g=="undefined"){g=true}var d=false;var j=h.innerHTML;h.innerHTML="";var a=this.add_span(null,"H",h);var i=Math.max(a.offsetHeight,a.clientHeight);var b=Math.max(0,h.scrollHeight-h.clientHeight);h.removeChild(a);h.innerHTML=j;c=c.replace(/^\s+|\s+$/g,"");while((h.clientHeight+b+(i/2))<h.scrollHeight){d=true;if(g){c=l&&c.search(/\s/)>=0?c.replace(/\s+\S+$/,""):c.substr(0,c.length-1);var k=h.getElementsByTagName("bde");if(h.getElementsByTagName("span").length>0){h.removeChild(h.getElementsByTagName("span")[0])}((k.length>0)?k[0]:h).innerHTML=c;this.add_span(null,"&hellip;",h)}else{var m=this.getFontSize(h);if(parseInt(m)<=9){break}m=parseInt(m)-1;var f="font-size: "+m+"px!important; line-height: "+m*1.25+"px!important;";if(typeof(h.style.cssText)=="string"){h.style.cssText=f}else{h.setAttribute("style",f)}}}if(__trcBrowser.ie&&!d){h.style.height="auto"}};TRCRBox.prototype.removeTagsEntities=function(b){var a=new RegExp("<[^>]*>$");if(!a.test(b)){a=new RegExp("&w+;$");if(!a.test(b)){return b}}return b.replace(a,"")};TRCRBox.prototype.removeHtmlTags=function(a){return a.replace(new RegExp("<[^>]+>","g"),"")};TRCRBox.prototype.formatData=function(c,a){var b=this.trc.getProperty(this.mode_name,"format-"+c);b=b||"%s";if(typeof b=="function"){return b.call(this,a)}if((c.search("duration")>=0)||(c.search("Duration")>=0)){a=this.formatDuration(a)}if(typeof a=="undefined"){a=""}return b.replace(new RegExp("%\\w"),'<dt style="display:inline">'+a+"</dt>")};TRCRBox.prototype.formatDuration=function(d){var a=parseInt(d/3600);if(a>=1){d=d%3600}else{a=0}var b=parseInt(d/60);var c=parseInt(d%60);if(typeof a!="number"||typeof b!="number"||typeof c!="number"||isNaN(a)||isNaN(b)||isNaN(c)||d<1){return""}return(a>=1?(a+":"):"")+(b<10?"0":"")+b+":"+(c<10?"0":"")+c};TRCRBox.prototype.formatNumber=function(a){if(typeof a!="undefined"){return this.trc.getFunction(this.mode_name,"format-number",a)}else{return""}};TRCRBox.prototype.genLoading=function(){var d=document.createElement("div");d.className="loading-animation";var c=this.trc.getProperty(this.mode_name,"loading-animation-url");if(c!="null"&&c!="hide"){var a=document.createElement("img");a.src=c;d.appendChild(a)}var b=document.createElement("span");b.innerHTML=this.trc.gt.gettext("Loading...");d.appendChild(b);while(this.listContainer.firstChild){this.listContainer.removeChild(this.listContainer.firstChild)}this.listContainer.appendChild(d);return d};TRCRBox.prototype.dateFormatISO=function(c){var f=new Date(parseInt(c)*1000);var b=f.getFullYear();var a=f.getMonth()+1;var d=f.getDate();if(d<10){d="0"+d}if(a<10){a="0"+a}return b+"-"+a+"-"+d};TRCRBox.prototype.dateFormatAmerican=function(c){var f=new Date(parseInt(c)*1000);var b=f.getFullYear();var a=f.getMonth()+1;var d=f.getDate();return a+"/"+d+"/"+b};TRCRBox.prototype.dateFormatEuropean=function(c){var f=new Date(parseInt(c)*1000);var b=f.getFullYear();var a=f.getMonth()+1;var d=f.getDate();return d+"/"+a+"/"+b};TRCRBox.prototype.dateFormatDays=function(i){var b=new Date();var d=" months ago";var c=b.getFullYear();var l=b.getMonth();var a=new Date();if(typeof i!="undefined"||parseInt(i)!=0){a=new Date(parseInt(i)*1000)}var g=a.getFullYear();var h=a.getMonth();var k=(c*12+l)-(g*12+h);if(k==0){var f=b.getDate();var j=a.getDate();k=f-j;if(k<=1){d=" day ago"}else{d=" days ago"}}else{if(k==1){d=" month ago"}}return k+d};TRCRBox.prototype.ratingStars=function(g,d){if(d>5){d=Math.floor(d/2)}if(typeof g=="undefined"){return""}var a=document.createElement("span");for(var f=0;f<d;f++){var c=document.createElement("img");c.style.width="16px";c.style.height="16px";c.style.display="inline";var b="http://cdn.taboolasyndication.com/taboola/star-on.png";var h="http://cdn.taboolasyndication.com/taboola/star-off.png";if(f<parseInt(g)){c.src=b}else{c.src=h}a.appendChild(c)}return a};TRCRBox.prototype.getFontSize=function(f){var a=0;var d=false;var c=document.trcGetCurrentStyle(f,"font-size");var b=["px","pt","em","ch"];while((!d)&&(a<b.length)){if(c.indexOf(b[a])){c=parseInt(c);switch(b[a]){case"px":c=c-1;break;case"pt":c=(c/0.75)-1;break;case"em":case"ch":c=(c*10)-1;break}d=true}a++}return c};window.TRC.implClasses.TRCRBox=TRCRBox;window.TRC.LightBoxManager=(function(){function LightBoxManager(displayTitle,originEvent,listId,direction,fps){this.animationLength=300;this.fps=typeof fps=="number"?fps:(__trcBrowser.firefoxUpto(3.5)?20:45);this.listId=listId;this.direction=typeof direction!="undefined"?direction:"ltr";this.origCoords=[0,0];this.lightbox_container=null;this.whitebox=null;this.whitebox_header=null;this.playerbox=null;this.playerContainer=null;this.animationLoop=null;this.animationEvents=[];this.whiteboxSizeHandler=null;this.position_fixed_works=false;this.player_width=0;this.player_height=0;this.scalingLock=false;this.additionalElements={};this.displayTitle=displayTitle;this.elementsHaveBeenAdded=false;if(originEvent&&typeof originEvent.clientX=="number"){this.origCoords=[originEvent.clientX,originEvent.clientY]}else{this.origCoords=[this.getScreenWidth()/2,100]}if(__trcBrowser.ie){var zoom=this.GetZoomFactor();this.origCoords=[Math.round((this.origCoords[0]-document.documentElement.clientLeft)/zoom),Math.round((this.origCoords[1]-document.documentElement.clientTop)/zoom),]}this.createLightbox();this.lightbox_container.style.cursor="wait";return this}LightBoxManager.prototype.GetZoomFactor=function(){if(!document.body.getBoundingClientRect){return 1}var rect=document.body.getBoundingClientRect();var physicalW=rect.right-rect.left;var logicalW=document.body.offsetWidth;return Math.round((physicalW/logicalW)*100)/100};LightBoxManager.prototype.addElements=function(elms){if(typeof elms!="object"){elms={bottom:elms}}for(p in elms){if(!this.additionalElements[p]){this.additionalElements[p]=[]}this.additionalElements[p].push(elms[p])}};LightBoxManager.prototype.renderElements=function(){this.elementsHaveBeenAdded=true;function addSubElement(position,e){var div=document.createElement("div");switch(position){case"left":div.style.cssFloat=div.style.styleFloat="left";break;case"right":div.style.cssFloat=div.style.styleFloat="left";break}if(position=="bottom"){this.playerbox.parentNode.appendChild(div)}else{this.playerbox.parentNode.insertBefore(div,this.playerBox)}try{if(typeof e=="function"){e(div)}else{if(typeof e.render=="function"){e.render(div)}}}catch(e){__trcError("Error in lightbox sub-element rendering",e)}}if("top" in this.additionalElements){this.additionalElements.top.forEach(addSubElement.trcBind(this,"top"))}if("left" in this.additionalElements){this.additionalElements.left.forEach(addSubElement.trcBind(this,"left"))}if("right" in this.additionalElements){this.additionalElements.right.forEach(addSubElement.trcBind(this,"right"))}if("bottom" in this.additionalElements){this.additionalElements.bottom.forEach(addSubElement.trcBind(this,"bottom"))}};LightBoxManager.prototype.createLightbox=function(){var width=this.getScreenWidth();this.lightbox_container=document.createElement("div");this.lightbox_container.style.width=width+"px";this.lightbox_container.style.position="absolute";this.lightbox_container.style.left="0px";this.lightbox_container.style.top="0px";this.lightbox_container.className="trc_lightbox_base trc_lightbox "+this.listId;var inner_div=document.createElement("div");inner_div.style.display="block";inner_div.className="trc_lightbox_overlay";inner_div.style.width=width+"px";inner_div.style.left="0px";inner_div.style.top="0px";this.lightbox_container.appendChild(inner_div);inner_div=document.createElement("div");inner_div.style.display="block";inner_div.className="trc_lightbox_transparent";inner_div.style.width=width+"px";inner_div.style.left="0px";inner_div.style.top="0px";this.lightbox_container.appendChild(inner_div);document.body.appendChild(this.lightbox_container);this.whitebox=document.createElement("div");this.whitebox.className="trc_whitebox";this.whitebox.style.visibility="hidden";inner_div.appendChild(this.whitebox);this.playerbox=document.createElement("div");this.playerContainer=document.createElement("div");this.playerContainer.appendChild(this.playerbox);with(this.playerContainer.style){width="0px";height="0px";overflow="hidden"}this.whitebox.appendChild(this.playerContainer);with(inner_div.style){marginTop="30px";position="fixed"}this.position_fixed_works=(inner_div.offsetTop===30);if(!this.position_fixed_works){inner_div.style.position="absolute"}this.lightbox_container.style.height=this.lightbox_container.firstChild.style.height=this.getScreenHeight()+"px"};LightBoxManager.prototype.createHeader=function(title_text,branding_url){var div=document.createElement("div");div.id="trc_lightbox_header";div.style.display="none";if(typeof branding_url!="undefined"&&branding_url!=""){var branding_div=document.createElement("div");branding_div.id="branding_div_lightbox";var branding_img=document.createElement("img");branding_img.id="branding_img_lightbox";branding_img.src=branding_url;branding_div.style.styleFloat=branding_div.style.cssFloat=(this.direction=="ltr")?"right":"left";branding_img.style.display="none";branding_div.appendChild(branding_img);div.appendChild(branding_div)}var title_div=document.createElement("div");if(this.displayTitle){title_div.innerHTML=title_text}else{title_div.innerHTML="";title_div.style.height="22px"}div.appendChild(title_div);div.titlebox=title_div;this.whitebox_header=div;this.whitebox.insertBefore(div,this.whitebox.firstChild)};LightBoxManager.prototype.setTitle=function(title_text){if(this.displayTitle){this.whitebox_header.titlebox.innerHTML=title_text}else{this.whitebox_header.titlebox.innerHTML=" "}};LightBoxManager.prototype.createLightboxCloseButton=function(){var closeButton=document.createElement("div");closeButton.className="trc_whiteboxCloseButton";closeButton.innerHTML="x";closeButton.onclick=this.close.trcBind(this);this.whitebox.insertBefore(closeButton,this.whitebox.firstChild)};LightBoxManager.prototype.startAnimate=function(pips,onComplete){var doneHandler=function(){for(var i=0;i<pips.length;i++){if(!pips[i].done){return}}onComplete()};pips.forEach(function(it){it.elm=it[0];it.prop=it[1];it.cur=it[2];it.end=it[3];it.unit=it[4];it.dur=it[5];it.done=false;it.steps=Math.ceil(this.fps*it.dur/1000);it.stepSize=(it.end-it.cur)/it.steps;it.step=0;this.animationEvents.push((it.frameHandler=function(){this.cur+=this.stepSize;if(this.stepSize*(this.cur-this.end)>0){this.cur=this.end}switch(this.prop){case"opacity":this.elm[this.prop]=this.cur;this.elm.filter="alpha(opacity="+(this.cur*100)+")";break;default:this.elm[this.prop]=this.cur+this.unit}if(++this.step>this.steps){this.done=true;doneHandler();return true}return false}).trcBind(it))},this)};LightBoxManager.prototype.animationMainLoop=function(){this.animationEvents.forEach(function(it,i,ar){if(it==null){return}if(it()){ar[i]=null}})};LightBoxManager.prototype.getScreenWidth=function(){return document.body.scrollWidth};LightBoxManager.prototype.getScreenHeight=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)};LightBoxManager.prototype.getLeftMargin=function(){return(this.getScreenWidth()-this.playerContainer.scrollWidth)/2};LightBoxManager.prototype.getScreenPosition=function(){return Math.max(document.documentElement.scrollTop,document.body.scrollTop)};LightBoxManager.prototype.fixSyndicatorLogo=function(){if(this.scalingLock){return}if(this.whitebox_header.style.display=="none"){return}var branding_img=this.whitebox_header.getElementsByTagName("img");if(branding_img.length>0){with(branding_img[0].style){height=this.whitebox_header.titlebox.scrollHeight+"px";width="auto";display="block"}}this.whitebox_header.style.width=this.player_width+"px"};LightBoxManager.prototype.animateOpening=function(){this.scalingLock=true;this.playerContainer.style.visibility="hidden";with(this.whitebox.style){width="10px";height="10px";marginLeft=(this.origCoords[0]-5)+"px";marginTop=(this.origCoords[1]-5)+"px";visibility="visible"}var playerW=this.playerContainer.scrollWidth;var playerH=this.playerContainer.scrollHeight;this.startAnimate([[this.whitebox.style,"width",10,playerW,"px",this.animationLength],[this.whitebox.style,"height",10,playerH,"px",this.animationLength],[this.whitebox.style,"marginLeft",this.origCoords[0]-5,this.getLeftMargin(),"px",this.animationLength],[this.whitebox.style,"marginTop",this.origCoords[1]-5,30,"px",this.animationLength]],(function(){this.createLightboxCloseButton();this.whitebox_header.style.display="block";this.scalingLock=false;this.player_width=playerW-0.2;this.player_height=playerH-0.2;this.playerContainer.style.visibility="visible"}).trcBind(this))};LightBoxManager.prototype.resizeWhitebox=function(){if(this.scalingLock){return}if(this.player_width==0){this.animateOpening();return}if(this.player_width<this.playerContainer.scrollWidth||this.player_height<this.playerContainer.scrollHeight){this.scalingLock=true;this.startAnimate([[this.playerContainer.style,"width",this.player_width,this.playerContainer.scrollWidth,"px",300],[this.playerContainer.style,"height",this.player_height,this.playerContainer.scrollHeight,"px",300],[this.whitebox.style,"width",this.player_width,this.playerContainer.scrollWidth,"px",300],[this.whitebox.style,"height",this.player_height+this.whitebox_header.clientHeight,this.playerContainer.scrollHeight+this.whitebox_header.clientHeight,"px",300]],(function(){this.scalingLock=false;if(!this.elementsHaveBeenAdded){this.renderElements()}}).trcBind(this));this.player_width=Math.max(this.player_width,this.playerContainer.scrollWidth);this.player_height=Math.max(this.player_height,this.playerContainer.scrollHeight)}};LightBoxManager.prototype.open=function(){typeof PageManager!="undefined"&&PageManager.pushState();this.lightbox_container.style.cursor="auto";this.animationLoop=window.setInterval(this.animationMainLoop.trcBind(this),Math.floor(1000/this.fps));this.whiteboxSizeHandler=(function(){if(!(this.playerContainer.scrollHeight>0&&this.playerContainer.scrollWidth>0)){return false}this.lightbox_container.style.height=this.lightbox_container.firstChild.style.height=this.getScreenHeight()+"px";if(!this.position_fixed_works){this.whitebox.parentNode.style.top=(this.getScreenPosition()+30)+"px"}this.fixSyndicatorLogo();this.resizeWhitebox();return false}).trcBind(this);this.animationEvents.push(this.whiteboxSizeHandler);if(!this.position_fixed_works){document.documentElement[__trcBrowser.ie?"attachEvent":"addEventListener"](__trcBrowser.ie?"onscroll":"scroll",this.whiteboxSizeHandler,false)}};LightBoxManager.prototype.close=function(){for(var p in this.additionalElements){this.additionalElements[p].forEach(function(e){if(typeof e=="object"&&typeof e.close=="function"){e.close()}})}window.setTimeout(this.realClose.trcBind(this),500)};LightBoxManager.prototype.realClose=function(){var currentMargin=this.getLeftMargin();var flashObjects=this.playerContainer.getElementsByTagName("object");for(var i=0;flashObjects&&i<flashObjects.length;i++){var tag=flashObjects[i];var closingContainer=document.body.appendChild(document.createElement("div"));closingContainer.style.display="none";tag.style.display="none";tag.parentNode.removeChild(tag);closingContainer.appendChild(tag);window.setTimeout(function(){tag.movie="//dummy";tag.parentNode.removeChild(tag);closingContainer.parentNode.removeChild(closingContainer)},250)}this.whitebox.removeChild(this.playerContainer);this.whitebox.removeChild(this.whitebox_header);if(!this.position_fixed_works&&this.whiteboxSizeHandler!=null){document.documentElement[__trcBrowser.ie?"attachEvent":"addEventListener"](__trcBrowser.ie?"onscroll":"scroll",this.whiteboxSizeHandler,false)}this.startAnimate([[this.whitebox.style,"width",this.whitebox.clientWidth,0,"px",this.animationLength],[this.whitebox.style,"height",this.whitebox.clientHeight,0,"px",this.animationLength],[this.whitebox.style,"marginLeft",currentMargin,this.getScreenWidth()/2,"px",this.animationLength],[this.whitebox.style,"marginTop",30,this.whitebox.clientHeight/2,"px",this.animationLength],[this.whitebox.style,"opacity",1,0,"",this.animationLength]],(function(){document.body.removeChild(this.lightbox_container);window.clearInterval(this.animationLoop);this.animationLoop=null;typeof PageManager!="undefined"&&PageManager.popState()}).trcBind(this));if(typeof window.trc_lightboxClose=="function"){window.trc_lightboxClose()}};return LightBoxManager})();var TRCAutoPlaylistController=(function(){function a(f,i,h,c,g,d,b){this.animationDelay=1000/40;this.videoData=g;this.rbox=f;this.publisher=i;this.embedCode=h;this.videoDoneHandler=null;this.autoPlayContainer=c;this.gt=this.rbox.trc.gt;this.listId=d;this.container=document.createElement("div");this.countdownBox=null;this.counterBox=null;this.countdownTimer=null;this.lightbox=(typeof h=="function");this.playlistRecommendation=null;this.playlistItemBox=document.createElement("div");this.autoplayTime=(typeof b=="undefined")?5:b;this.active=(this.autoplayTime!=-1);this.isRender=false;this.createPlayer();this.pv="2"}a.prototype.videoDone=function(b){if(this.countdownBox.style.display!="none"){return}if(!this.checkContainerVisibility()){return}if(this.container.style.display!="block"&&!this.lightbox){if(this.playlistItemBox.firstChild==null){this.getPlaylistItem("n")}this.showNextUp()}(function(d){if(d<=0){this.log("playlist",{ri:this.reqId,sd:this.sesData,ui:this.userData,pi:this.videoData.id,pt:"video",li:this.listId});this.activateNextUp("n");return}var c=""+d--;while(c.length<2){c="0"+c}this.counterBox.innerHTML=Gettext.strargs(this.gt.gettext("in %1 Seconds"),[c]);this.countdownTimer=window.setTimeout(arguments.callee.trcBind(this,d),1000)}).trcBind(this,this.autoplayTime)();if(this.autoplayTime>0){this.showCountdown()}};a.prototype.getScreenPosition=function(){return Math.max(document.documentElement.scrollTop,document.body.scrollTop)};a.prototype.autoPlayerLinkTargetSupport=function(c){function b(f){var d;if(__trcBrowser.ie){d=document.createEventObject();d.button=1}else{d=document.createEvent("MouseEvent");d.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null)}return d}if(typeof c!="undefined"){this.playlistRecommendation.link.onclick(c,"playlist")}else{this.playlistRecommendation.link.onclick(b(this.playlistRecommendation),"playlist")}};a.prototype.activateNextUp=function(c,b){if(this.countdownTimer){window.clearTimeout(this.countdownTimer);this.countdownTimer=null}PageManager.storePublisherValue(this.publisher,"auto-play-intent",new Date().getTime()+":"+this.playlistRecommendation.id+":"+c);this.videoData=this.playlistRecommendation;if(this.lightbox){this.createPlayer();this.getPlaylistItem(c)}else{this.autoPlayerLinkTargetSupport(b)}if(this.countdownBox.style.display!="none"){this.hideCountdown()}this.hideNextUp();this.playlistItemBox.removeChild(this.playlistItemBox.firstChild)};a.prototype.showNextUp=function(){this.container.style.display="block";this.container.style.opacity=1;this.log("visible",{ri:this.reqId,sd:this.sesData,ui:this.userData,pi:this.videoData.id,pt:"video",li:this.listId});if(__trcBrowser.ie){this.container.style.marginLeft=((this.container.parentNode.offsetWidth-this.container.clientWidth)/2)+"px"}};a.prototype.hideNextUp=function(){this.container.style.display="none";this.container.style.opacity=0};a.prototype.animValueSet=function(d,f,c,b){switch(b){case"size":d[f]=c+"px";break;case"opacity":d.filter="alpha(opacity="+(c+100)+")";d[f]=c;break;default:d[f]=c}},a.prototype.animCall=function(g,d,f,b,j,h){if(typeof h=="undefined"){h="size"}var k=parseInt(d/this.animationDelay);var i=parseFloat(f[b]);var c=(g-i)/k*5;this.animValueSet(f,b,i+c,h);if(d-this.animationDelay>0){window.setTimeout(arguments.callee.trcBind(this,g,d-this.animationDelay,f,b),this.animationDelay)}else{this.animValueSet(f,b,g,h);if(typeof j=="function"){j()}}};a.prototype.showCountdown=function(){var d=this.countdownBox.parentNode;var b=Math.max(d.clientWidth,d.offsetWidth);this.countdownBox.style.display="inline";var c=Math.max(d.clientWidth,d.offsetWidth);d.style.width=b+"px";this.animCall(c,750,d.style,"width")};a.prototype.hideCountdown=function(){this.countdownBox.style.display="none";this.countdownBox.parentNode.style.width="auto"};a.prototype.checkContainerVisibility=function(){if(this.autoPlayContainer.playerbox.offsetTop>=this.getScreenPosition()){return true}else{return false}};a.prototype.createPlayer=function(){if(!this.lightbox){return}if(typeof this.autoPlayContainer.playerbox!="undefined"){while(this.autoPlayContainer.playerbox.childNodes.length>0){this.autoPlayContainer.playerbox.removeChild(this.autoPlayContainer.playerbox.firstChild)}}this.embedCode.apply(null,[this.autoPlayContainer.playerbox,this.videoData]);if(typeof this.autoPlayContainer.setTitle=="function"){this.autoPlayContainer.setTitle(this.videoData.title)}};a.prototype.close=function(){if(this.videoDoneHandler){this.videoDoneHandler.remove()}if(typeof this.videoData.lightboxClosed=="function"){this.videoData.lightboxClosed()}};a.prototype.render=function(b){if(!this.active){return}this.isRender=true;this.getPlaylistItem("s");this.videoDoneHandler=window.TRC.listen("videoDone",this.videoDone.trcBind(this));b.appendChild(this.container);this.container.className="trc_autoplaylist-box";this.container.style.display="none";this.container.appendChild(this.genHeader());this.container.appendChild(this.playlistItemBox);var c=document.createElement("div");c.style.clear="both";this.container.appendChild(c);this.container.onmouseover=(function(){this.log("explore",{ri:this.reqId,sd:this.sesData,ui:this.userData,pi:this.videoData.id,pt:"video",li:this.listId})}).trcBind(this);if(this.playlistRecommendation!=null){this.showNextUp()}};a.prototype.genPlaylistURL=function(d){var b="http://trc.taboolasyndication.com/"+this.publisher+"/trc/"+this.pv+"/json";var f={"list-id":this.listId,"list-size":1,id:parseInt(Math.random()*1000),embed:window.location.href,"item-type":"video","item-id":this.videoData.id,"page-id":PageManager.getPageData(this.videoData.id,this.publisher),sd:PageManager.getPublisherValue(this.publisher,"session-data"),uid:PageManager.getValue("user-id")};if(d){f.intent=d}var g=[];for(var c in f){g.push(encodeURIComponent(c)+"="+encodeURIComponent(f[c]))}return b+"?tim="+encodeURIComponent(__trcClientTimestamp())+"&"+g.join("&")+PageManager.additionalDispatchParams()};a.prototype.getPlaylistItem=function(c){if(!this.lightbox){window.setTimeout(this.getPlaylistItemFromRBox.trcBind(this),0);return}var b=this.genPlaylistURL(c);this.rbox.trc.loadExternal(b,"js",(function(){var d={};__trcCopyProps(trc_json_response,d);trc_json_response=null;if(typeof d.trc=="undefined"||typeof d.trc["video-list"]=="undefined"||typeof d.trc["video-list"].video=="undefined"){this.hideNextUp();return}this.reqId=d.trc.req;this.sesData=d.trc["session-data"];this.userData=d.trc["user-id"];PageManager.storePublisherValue(this.publisher,"session-data",this.sesData);PageManager.storeValue("user-id",this.userData);var f=d.trc["video-list"].video;this.playlistRecommendation=f.length?f[0]:f;this.playlistItemBox.appendChild(this.drawVideoBox(this.playlistRecommendation));if(this.countdownBox){this.showNextUp()}}).trcBind(this))};a.prototype.getPlaylistItemFromRBox=function(d){if(this.playlistItemBox.firstChild!=null){this.playlistItemBox.removeChild(this.playlistItemBox.firstChild)}var b=0;for(var c=0;c<this.rbox.recommendationList.length-1;c++){if(this.rbox.recommendationList[c].type=="video"&&this.rbox.recommendationList[c]!=this.playlistRecommendation){b=c;break}}this.playlistRecommendation=this.rbox.recommendationList[b];this.playlistItemBox.appendChild(this.drawVideoBox(this.playlistRecommendation))};a.prototype.genBlock=function(c,b,d){var f=document.createElement(b?b:"div");for(p in c){if(typeof c[p]=="string"){f[p]=c[p]}else{if(typeof c[p]=="object"){for(p1 in c[p]){f[p][p1]=c[p][p1]}}}}if(typeof d=="string"){f.appendChild(document.createTextNode(d))}return f};a.prototype.drawVideoBox=function(d){var c=this.genBlock({className:"videobox nextup"});var b=this.genBlock({className:"thumbblock",style:{cssFloat:"left",styleFloat:"left",display:"block"}},"span");c.appendChild(b);b.appendChild(this.genBlock({className:"thumbnail",style:{height:"29px",width:"39px",display:"block",backgroundImage:"url('"+d.thumbnail+"')"}},"span"));b.appendChild(this.genBlock({className:"thumbnail-overlay",style:{height:"29px",width:"39px",display:"block",marginTop:"-29px"}},"span"));var f=this.genBlock({style:{display:"block"},className:"video-label-box"},"span");c.appendChild(f);f.appendChild(this.genBlock({className:"video-label video-title"},"span",d.title));c.onclick=(function(g){this.log("click",{ri:this.reqId,sd:this.sesData,ui:this.userData,pi:this.videoData.id,pt:"video",li:this.listId});this.activateNextUp("s",g)}).trcBind(this);return c};a.prototype.genHeader=function(){var b=document.createElement("span");b.className="trc-next-up-header";b.appendChild(document.createTextNode(this.gt.gettext("Next Up:")+" "));this.countdownBox=document.createElement("span");b.appendChild(this.countdownBox);this.countdownBox.className="trc-next-up-countdown";this.counterBox=document.createElement("span");this.countdownBox.appendChild(this.counterBox);this.countdownBox.style.display="none";return b};a.prototype.log=function(c,g,j){var i=c+":"+g.li+g.ii+g.ri;if(!this.ev){this.ev={}}if(this.ev[i]){this.ev[i]++;return}this.ev[i]=1;try{var b="http://trc.taboolasyndication.com/"+this.publisher+"/log/"+this.pv+"/"+encodeURIComponent(c)+"?";for(name in g){var d=name.charAt(0)=="_"?name.substr(1):name;if(typeof g[name]!="undefined"&&g[name]!=null){b+=encodeURIComponent(d)+"="+encodeURIComponent(g[name])+"&"}}b+="id="+parseInt(Math.random()*10000);var h=new Image();h.src=b+"&url="+encodeURIComponent("http://cdn.taboolasyndication.com/pixel.gif")}catch(f){__trcError("Error in sending auto playlist event",f)}};return a})();window.TRC.PostRenderQueue=(function(){var b=[];var a=function(){return this};a.prototype.pushBack=function(c,d){__trcInfo("TRCRBox.postRenderQueue.pushBack("+c+")");b.push({name:c,func:d})};a.prototype.pushFront=function(c,d){__trcInfo("TRCRBox.postRenderQueue.pushFront("+c+")");b.unshift({name:c,func:d})};a.prototype.popFront=function(){if(b.length==0){return null}var c=b.shift();if(typeof c=="function"){return{name:"unknown",func:c}}else{return c}};return a})();window.TRC.implClasses.GoogleAd=(function(){var a=function(b,c,d,f){this.options=c;this.trc=d;this.reqParams=f;this.element=null;this.internalc=null;this.id=Math.floor(Math.random()*100000);return this};a.prototype.render=function(c){while(c.firstChild!=null){c.removeChild(c.firstChild)}this.element=document.createElement("div");this.element.id="gad_wrapper_"+this.id;this.element.className="trc_rbox "+this.options.mode_name;this.element.style.overflow="hidden";this.element.style.display="block";c.appendChild(this.element);var b=this.trc.getProperty(this.options.mode_name,"component-id");var d=document.createElement("div");d.id=b;d.className="trc_rbox_div trc_rbox_border_elm";d.style.overflowX="hidden";d.style.overflowY="hidden";this.element.appendChild(d);this.internalc=d;this.trc.log1("available",{pi:this.reqParams["item-id"],pt:this.reqParams["item-type"],li:b})};a.prototype.getListId=function(){return""};a.prototype.getContainer=function(){return this.element.parentNode};a.prototype.getMainBox=function(){return this.internalc};a.prototype.load=function(c,b){window.setTimeout(this.drawAd.trcBind(this),0)};a.prototype.drawAd=function(){this.trc.getFunction(this.options.mode_name,"list-suffix",this.internalc,this)};a.prototype.sendEvent=function(b,d){var c={pi:this.reqParams["item-id"],pt:this.reqParams["item-type"],li:this.options.mode_name};if(!!this.options.response&&!!this.options.response.trc){c.ri=this.options.response.trc.req;c.sd=this.options.response.trc["session-data"];c.ui=this.options.response.trc["user-id"]}__trcCopyProps(d,c);this.trc.logTrcEvent(b,c)};return a})();window.TRC.GoogleAds=function(b,d,c,a){this.rbox=b;this.channel=c;this.slot=d;this.clientId=a||"ca-pub-8313336773978288";this.gamInWrapper=true;return this};window.TRC.GoogleAds.prototype.draw=function(cont_size,gam_size,reserve_header,vertical){try{if(!gam_size||gam_size.length!=2||!cont_size||cont_size.length!=2){__trcError("Invalid GAM size and Container size!");return}var wrap=this.rbox.getMainBox();var gam=document.createElement("div");gam.className="gam_wrapper";with(gam.style){if(vertical){clear="right"}else{cssFloat="right";styleFloat="right"}if(__trcBrowser.ieUpto(6)){for(var elm=this.rbox.getMainBox().firstChild;elm!=null;elm=elm.nextSibling){if(elm.className.search("outer")>=0){elm.styleFloat="left"}}}width=cont_size[0]+"px";height=(reserve_header+cont_size[1])+"px"}if(reserve_header){gam.appendChild(document.createElement("div"));gam.firstChild.style.height=reserve_header+"px";gam.firstChild.className="gam_header"}var container=document.createElement("div");container.className="gam_container";with(container.style){height=cont_size[1]+"px"}gam.appendChild(container);if(vertical){if(this.gamInWrapper){wrap.insertBefore(gam,wrap.childNodes[wrap.childNodes.length-1])}else{wrap.parentNode.insertBefore(gam,wrap.nextSibling)}}else{if(this.gamInWrapper){wrap.insertBefore(gam,wrap.firstChild)}else{wrap.parentNode.insertBefore(gam,wrap)}}this.genAdBox(container,cont_size,gam_size)}catch(e){__trcError("Error in GoogleAds.draw",e);return}};window.TRC.GoogleAds.prototype.genAdBox=function(b,a,d){try{if(!!this.rbox.trc.getProperty(this.rbox.mode_name,"gam-allow-trc-ads")&&this.checkTRCAdSize(a[0],a[1])&&this.getTRCAdBox(b)){__trcInfo("GoogleAds.genAdBox: displaying a trc ad in the box");return}this.getGoogleAdBox(b,d)}catch(c){__trcError("Error in GoogleAds.genAdBox",c)}};window.TRC.GoogleAds.prototype.checkTRCAdSize=function(a,c){for(var b=0;b<this.rbox.boxes.length;b++){var d=this.rbox.boxes[b];if(d.parentNode==null){continue}if(d.clientWidth>0&&d.clientHeight>0){return d.clientWidth<=a&&d.clientHeight<=c}}return false};window.TRC.GoogleAds.prototype.sendEvent=function(){this.rbox.sendEvent("display",{ii:"-1",it:"text-ad"})};window.TRC.GoogleAds.prototype.getTRCAdBox=function(a){for(var b=0;b<this.rbox.boxes.length;b++){if(!this.rbox.boxes[b].video_data.isAd){continue}var c=this.rbox.boxes.splice(b,1)[0];if(c.parentNode){c.parentNode.removeChild(c);if(this.rbox.trc.getProperty(this.rbox.mode_name,"navigation-type")=="paging"){this.rbox.drawPager()}}a.appendChild(c);return true}return false};window.TRC.GoogleAds.prototype.getGoogleAdBox=function(container,gam_size){__trcInfo("Enter GoogleAds.getGoogleAdBox");try{var igam=document.createElement("iframe");with(igam.style){width=gam_size[0]+"px";height=gam_size[1]+"px";border=0}igam.scrolling="no";var ieDomainWorkaround=__trcBrowser.ie&&(document.domain!=window.location.hostname);if(ieDomainWorkaround){__trcInfo("Within GoogleAds.getGoogleAdBox: use IE domain workaround");igam.src='javascript:"<script>window.onload=function(){document.write(\\"<script>document.domain=\''+document.domain+'\';<\\"+\\"/script>\\");document.close();};<\/script>"'}container.appendChild(igam);var displayad=function(){__trcInfo("Called GoogleAds.getGoogleAdBox.displayad");var idoc=igam.contentDocument?igam.contentDocument:igam.contentWindow.document;idoc.write("<html><head><style>BODY,IFRAME{border:0;margin:0;padding:0;}</style></head><body><script>"+(document.domain!=window.location.hostname?('document.domain="'+document.domain+'";'):"")+'google_ad_client="'+this.clientId+'";google_ad_slot="'+this.slot+'";'+(this.channel?("google_ad_channel="+this.channel+";"):"")+"google_ad_width="+gam_size[0]+";google_ad_height="+gam_size[1]+';google_enable_async=false;<\/script><script src="http://pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript"><\/script></body></html>');window.setTimeout(function(){__trcInfo("Called GoogleAds.getGoogleAdBox.idoc.close");try{idoc.close()}catch(e){__trcError("Exit GoogleAds.getGoogleAdBox: error in idoc.close",e)}},__trcBrowser.ie?3000:0)};if(ieDomainWorkaround){window.setTimeout(displayad.trcBind(this),1000)}else{displayad.call(this)}this.sendEvent()}catch(e){__trcError("Exit GoogleAds.getGoogleAdBox: got an error",e);return}__trcInfo("Exit GoogleAds.getGoogleAdBox: success")};